<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academi DNS Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Vazirmatn', sans-serif;
        }
        
        .dark {
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #16213e;
            --text-primary: #eee6ff;
            --text-secondary: #a0a0db;
            --accent: #6366f1;
            --accent-hover: #4f46e5;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .light {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent: #6366f1;
            --accent-hover: #4f46e5;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-x: hidden;
        }
        
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--bg-tertiary);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }
        
        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            border-color: var(--accent);
        }
        
        .btn-primary {
            background: var(--gradient);
            color: white;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
        }
        
        /* Hamburger Menu */
        .hamburger {
            width: 30px;
            height: 30px;
            position: relative;
            cursor: pointer;
            z-index: 1001;
        }
        
        .hamburger span {
            display: block;
            position: absolute;
            height: 3px;
            width: 100%;
            background: var(--text-primary);
            border-radius: 3px;
            opacity: 1;
            left: 0;
            transform: rotate(0deg);
            transition: .25s ease-in-out;
        }
        
        .hamburger span:nth-child(1) {
            top: 0px;
        }
        
        .hamburger span:nth-child(2),
        .hamburger span:nth-child(3) {
            top: 10px;
        }
        
        .hamburger span:nth-child(4) {
            top: 20px;
        }
        
        .hamburger.open span:nth-child(1) {
            top: 10px;
            width: 0%;
            left: 50%;
        }
        
        .hamburger.open span:nth-child(2) {
            transform: rotate(45deg);
        }
        
        .hamburger.open span:nth-child(3) {
            transform: rotate(-45deg);
        }
        
        .hamburger.open span:nth-child(4) {
            top: 10px;
            width: 0%;
            left: 50%;
        }
        
        /* Menu Overlay */
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .menu-items {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            max-height: 80vh;
            overflow-y: auto;
            padding: 2rem;
        }
        
        .menu-item {
            display: block;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 1.5rem 0;
            text-decoration: none;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        
        .menu-overlay.active .menu-item {
            opacity: 1;
            transform: translateY(0);
        }
        
        .menu-item:nth-child(1) { transition-delay: 0.1s; }
        .menu-item:nth-child(2) { transition-delay: 0.2s; }
        .menu-item:nth-child(3) { transition-delay: 0.3s; }
        .menu-item:nth-child(4) { transition-delay: 0.4s; }
        .menu-item:nth-child(5) { transition-delay: 0.5s; }
        .menu-item:nth-child(6) { transition-delay: 0.6s; }
        .menu-item:nth-child(7) { transition-delay: 0.7s; }
        .menu-item:nth-child(8) { transition-delay: 0.8s; }
        .menu-item:nth-child(9) { transition-delay: 0.9s; }
        .menu-item:nth-child(10) { transition-delay: 1.0s; }
        
        .menu-item:hover {
            color: var(--accent);
            transform: scale(1.1);
        }
        
        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-20px);
            }
        }
        
        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
            }
            50% {
                box-shadow: 0 0 40px rgba(99, 102, 241, 0.6);
            }
        }
        
        .animate-fade-in-up {
            animation: fadeInUp 0.8s ease-out;
        }
        
        .animate-slide-in-left {
            animation: slideInLeft 0.8s ease-out;
        }
        
        .animate-slide-in-right {
            animation: slideInRight 0.8s ease-out;
        }
        
        .animate-bounce-in {
            animation: bounceIn 1s ease-out;
        }
        
        .animate-pulse {
            animation: pulse 2s infinite;
        }
        
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        
        .animate-glow {
            animation: glow 2s ease-in-out infinite;
        }
        
        /* Gradient backgrounds */
        .gradient-bg {
            background: var(--gradient);
        }
        
        .gradient-text {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* DNS Item Styles */
        .dns-item {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 4px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .dns-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .dns-item:hover::before {
            left: 100%;
        }
        
        .dns-item:hover {
            border-left-color: var(--accent);
            transform: translateX(10px);
        }
        
        /* Speed Test Styles */
        .speed-gauge {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #ef4444, #f59e0b, #10b981, #3b82f6);
            position: relative;
            margin: 0 auto;
        }
        
        .speed-needle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 80px;
            background: white;
            transform-origin: bottom center;
            transform: translate(-50%, -100%) rotate(0deg);
            transition: transform 2s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 2px;
        }
        
        .speed-center {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        /* Loading Spinner */
        .loading-spinner {
            border: 4px solid var(--bg-tertiary);
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Tab Styles */
        .tab-button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .tab-button.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        
        .tab-button:not(.active):hover {
            border-color: var(--accent);
            background: var(--bg-tertiary);
        }
        
        /* Auto DNS Switcher */
        .switcher-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .switcher-active {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .switcher-inactive {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--accent);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-hover);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .menu-item {
                font-size: 1.25rem;
                margin: 1rem 0;
            }
            
            .speed-gauge {
                width: 150px;
                height: 150px;
            }
        }
    </style>
</head>
<body class="light">
    <!-- Header -->
    <header class="fixed top-0 w-full z-50 card p-4 animate-fade-in-up">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-4 space-x-reverse">
                <img src="https://raw.githubusercontent.com/Academivpn73/DNS_panel/main/Academi_logo.png" 
                     alt="Academi Logo" 
                     class="w-12 h-12 rounded-full animate-float"
                     onerror="this.style.display='none'; document.querySelector('.fallback-icon').style.display='flex';">
                <div class="fallback-icon w-12 h-12 rounded-full gradient-bg flex items-center justify-center text-white text-2xl animate-float" style="display: none;">
                    🌐
                </div>
                <h1 class="text-2xl font-bold gradient-text">Academi DNS Manager</h1>
            </div>
            
            <div class="flex items-center space-x-4 space-x-reverse">
                <!-- User Panel -->
                <div id="userPanel" class="flex items-center space-x-3 space-x-reverse">
                    <div id="loggedOutPanel" class="flex items-center space-x-2 space-x-reverse">
                        <button onclick="showLoginModal()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-all">
                            👤 ورود
                        </button>
                        <button onclick="showRegisterModal()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-all">
                            📝 ثبت‌نام
                        </button>
                    </div>
                    
                    <div id="loggedInPanel" class="hidden flex items-center space-x-3 space-x-reverse">
                        <div class="flex items-center space-x-2 space-x-reverse bg-white/10 backdrop-blur-sm rounded-lg px-3 py-2">
                            <span class="text-2xl">👤</span>
                            <div>
                                <div id="userDisplayName" class="font-bold text-sm"></div>
                                <div class="text-xs opacity-75">کاربر آنلاین</div>
                            </div>
                        </div>
                        <button onclick="showSection('profile')" class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 rounded-lg transition-all">
                            ⚙️
                        </button>
                        <button onclick="logoutUser()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg transition-all">
                            🚪
                        </button>
                    </div>
                </div>
                
                <!-- Auto DNS Switcher Status -->
                <div id="autoSwitcherStatus" class="switcher-status switcher-inactive">
                    <span class="w-2 h-2 rounded-full bg-current"></span>
                    <span>خودکار خاموش</span>
                </div>
                
                <button id="themeToggle" class="btn-primary px-4 py-2 rounded-lg">
                    <span id="themeIcon">🌙</span>
                </button>
                
                <div class="hamburger" id="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </header>

    <!-- Menu Overlay -->
    <div class="menu-overlay" id="menuOverlay">
        <div class="menu-items">
            <div class="menu-item" data-section="home">🏠 خانه</div>
            <div class="menu-item" data-section="dns">🔧 مدیریت DNS</div>
            <div class="menu-item" data-section="tools">🛠️ ابزارهای پیشرفته</div>
            <div class="menu-item" data-section="speed">⚡ تست سرعت</div>
            <div class="menu-item" data-section="ping">📊 پینگ DNS</div>
            <div class="menu-item" data-section="compare">⚖️ مقایسه DNS</div>
            <div class="menu-item" data-section="education">📚 آموزش</div>
            <div class="menu-item" data-section="profile">👤 پنل کاربری</div>
            <div class="menu-item" data-section="ai">🤖 هوش مصنوعی</div>
            <div class="menu-item" data-section="admin" id="adminMenuItem" style="display: none;">👑 پنل ادمین</div>
            <div class="menu-item" data-section="about">ℹ️ درباره ما</div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <div id="notificationContent"></div>
    </div>

    <!-- Global Message Banner -->
    <div id="globalMessageBanner" class="fixed top-20 left-0 right-0 z-40 hidden">
        <div class="bg-gradient-to-r from-purple-600 to-blue-600 text-white p-4 mx-4 rounded-lg shadow-lg">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3 space-x-reverse">
                    <span class="text-2xl">📢</span>
                    <div>
                        <div class="font-bold">پیام مدیریت</div>
                        <div id="globalMessageContent" class="text-sm opacity-90"></div>
                    </div>
                </div>
                <div class="text-xs opacity-75" id="globalMessageDate"></div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="card p-8 rounded-2xl max-w-md w-full mx-4 animate-bounce-in">
            <div class="text-center mb-6">
                <div class="text-4xl mb-4">🔐</div>
                <h2 class="text-2xl font-bold">ورود به حساب کاربری</h2>
            </div>
            
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block font-medium mb-2">نام کاربری:</label>
                    <input type="text" id="loginUsername" required 
                           class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                </div>
                
                <div>
                    <label class="block font-medium mb-2">رمز عبور:</label>
                    <input type="password" id="loginPassword" required 
                           class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                </div>
                
                <div class="flex space-x-4 space-x-reverse">
                    <button type="submit" class="btn-primary px-6 py-3 rounded-lg flex-1">
                        🚀 ورود
                    </button>
                    <button type="button" onclick="closeLoginModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg flex-1 transition-all">
                        ❌ لغو
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="card rounded-2xl max-w-md w-full max-h-[90vh] overflow-hidden animate-bounce-in">
            <!-- Header -->
            <div class="p-6 border-b border-gray-200 text-center">
                <div class="text-4xl mb-4">📝</div>
                <h2 class="text-2xl font-bold">ثبت‌نام حساب جدید</h2>
            </div>
            
            <!-- Scrollable Content -->
            <div class="overflow-y-auto max-h-[60vh] p-6">
                <form id="registerForm" class="space-y-4">
                    <div>
                        <label class="block font-medium mb-2">نام:</label>
                        <input type="text" id="registerName" required 
                               class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                    </div>
                    
                    <div>
                        <label class="block font-medium mb-2">نام کاربری:</label>
                        <input type="text" id="registerUsername" required 
                               class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                    </div>
                    
                    <div>
                        <label class="block font-medium mb-2">رمز عبور:</label>
                        <input type="password" id="registerPassword" required 
                               class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                    </div>
                    
                    <div>
                        <label class="block font-medium mb-2">تکرار رمز عبور:</label>
                        <input type="password" id="registerPasswordConfirm" required 
                               class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                    </div>
                    
                    <!-- Captcha -->
                    <div class="p-4 rounded-lg border-2 border-gray-300" style="background: var(--bg-tertiary);">
                        <div class="flex items-center justify-between mb-3">
                            <span class="font-medium">تأیید انسان بودن:</span>
                            <button type="button" onclick="generateCaptcha()" class="text-blue-500 hover:text-blue-700">
                                🔄 تجدید
                            </button>
                        </div>
                        <div class="flex items-center space-x-4 space-x-reverse">
                            <div id="captchaDisplay" class="bg-gray-200 p-3 rounded font-mono text-xl font-bold text-gray-800 select-none"></div>
                            <input type="text" id="captchaInput" placeholder="کد را وارد کنید" required 
                                   class="flex-1 p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                        </div>
                    </div>
                </form>
            </div>
            
            <!-- Footer Buttons -->
            <div class="p-6 border-t border-gray-200">
                <div class="flex space-x-4 space-x-reverse">
                    <button onclick="handleRegister()" class="btn-primary px-6 py-3 rounded-lg flex-1">
                        ✅ ثبت‌نام
                    </button>
                    <button type="button" onclick="closeRegisterModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg flex-1 transition-all">
                        ❌ لغو
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 pt-24">
        <!-- Home Section -->
        <div id="homeSection" class="section">
            <!-- Hero Section -->
            <div class="text-center mb-12 animate-bounce-in">
                <div class="text-8xl mb-6 animate-float">🚀</div>
                <h2 class="text-5xl font-bold mb-4 gradient-text">مدیریت هوشمند DNS</h2>
                <p class="text-xl opacity-75 mb-8">تجربه اینترنت سریع‌تر و امن‌تر با بهترین DNS های جهان</p>
                <div class="flex justify-center space-x-4 space-x-reverse">
                    <button class="btn-primary px-8 py-4 rounded-xl text-lg font-bold animate-glow" data-section="dns">
                        🎯 شروع کنید
                    </button>
                    <button class="bg-purple-600 hover:bg-purple-700 text-white px-8 py-4 rounded-xl text-lg font-bold transition-all" data-section="ai">
                        🤖 هوش مصنوعی
                    </button>
                </div>
            </div>

            <!-- Features -->
            <div class="grid md:grid-cols-4 gap-6 mb-12">
                <div class="card p-6 rounded-2xl text-center animate-slide-in-left">
                    <div class="text-4xl mb-4 animate-pulse">⚡</div>
                    <h3 class="text-xl font-bold mb-2">سرعت بالا</h3>
                    <p class="text-sm opacity-75">DNS های بهینه شده برای حداکثر سرعت</p>
                </div>
                
                <div class="card p-6 rounded-2xl text-center animate-fade-in-up" style="animation-delay: 0.1s;">
                    <div class="text-4xl mb-4 animate-pulse">🔒</div>
                    <h3 class="text-xl font-bold mb-2">امنیت کامل</h3>
                    <p class="text-sm opacity-75">محافظت در برابر تهدیدات سایبری</p>
                </div>
                
                <div class="card p-6 rounded-2xl text-center animate-fade-in-up" style="animation-delay: 0.2s;">
                    <div class="text-4xl mb-4 animate-pulse">🤖</div>
                    <h3 class="text-xl font-bold mb-2">هوش مصنوعی</h3>
                    <p class="text-sm opacity-75">پیشنهادات هوشمند و بهینه‌سازی خودکار</p>
                </div>
                
                <div class="card p-6 rounded-2xl text-center animate-slide-in-right">
                    <div class="text-4xl mb-4 animate-pulse">🌍</div>
                    <h3 class="text-xl font-bold mb-2">دسترسی جهانی</h3>
                    <p class="text-sm opacity-75">دور زدن محدودیت‌های جغرافیایی</p>
                </div>
            </div>

            <!-- Statistics Dashboard -->
            <div class="grid md:grid-cols-4 gap-6 mb-12">
                <div class="card p-6 rounded-2xl text-center">
                    <div class="text-3xl font-bold text-blue-500 mb-2" id="totalTests">0</div>
                    <div class="text-sm opacity-75">تست انجام شده</div>
                </div>
                <div class="card p-6 rounded-2xl text-center">
                    <div class="text-3xl font-bold text-green-500 mb-2" id="avgSpeed">0</div>
                    <div class="text-sm opacity-75">میانگین سرعت (Mbps)</div>
                </div>
                <div class="card p-6 rounded-2xl text-center">
                    <div class="text-3xl font-bold text-purple-500 mb-2" id="bestPing">∞</div>
                    <div class="text-sm opacity-75">بهترین پینگ (ms)</div>
                </div>
                <div class="card p-6 rounded-2xl text-center">
                    <div class="text-3xl font-bold text-orange-500 mb-2" id="savedDNS">0</div>
                    <div class="text-sm opacity-75">DNS ذخیره شده</div>
                </div>
            </div>

            <!-- Advertisement -->
            <div class="card p-8 mb-8 gradient-bg text-white rounded-2xl animate-fade-in-up relative overflow-hidden">
                <!-- Background Pattern -->
                <div class="absolute inset-0 opacity-10">
                    <div class="absolute top-0 left-0 w-32 h-32 bg-white rounded-full -translate-x-16 -translate-y-16"></div>
                    <div class="absolute bottom-0 right-0 w-24 h-24 bg-white rounded-full translate-x-12 translate-y-12"></div>
                    <div class="absolute top-1/2 left-1/4 w-16 h-16 bg-white rounded-full"></div>
                </div>
                
                <div class="relative z-10">
                    <div class="text-center mb-8">
                        <!-- Logo -->
                        <div class="flex justify-center mb-6">
                            <img src="https://github.com/Academivpn73/DNS_panel/blob/main/Connectix.png?raw=true" 
                                 alt="Connectix Logo" 
                                 class="w-24 h-24 rounded-2xl shadow-2xl animate-float border-4 border-white/20"
                                 onerror="this.style.display='none'; document.querySelector('.connectix-fallback').style.display='flex';">
                            <div class="connectix-fallback w-24 h-24 rounded-2xl bg-white/20 backdrop-blur-sm flex items-center justify-center text-4xl animate-float border-4 border-white/20" style="display: none;">
                                🌐
                            </div>
                        </div>
                        
                        <h2 class="text-5xl font-bold mb-4 bg-gradient-to-r from-white to-blue-100 bg-clip-text text-transparent">
                            ✨ Connectix ✨
                        </h2>
                        <p class="text-2xl mb-8 font-light">با Connectix، اینترنت آزاد در دستان شماست!</p>
                    </div>
                    
                    <div class="grid md:grid-cols-3 gap-8 mb-8">
                        <div class="text-center p-6 bg-white/10 backdrop-blur-sm rounded-xl border border-white/20">
                            <div class="text-4xl mb-4 animate-pulse">🚀</div>
                            <h3 class="text-xl font-bold mb-2">سرعت فوق‌العاده</h3>
                            <p class="text-sm opacity-90">اتصال پرسرعت و پایدار</p>
                        </div>
                        <div class="text-center p-6 bg-white/10 backdrop-blur-sm rounded-xl border border-white/20">
                            <div class="text-4xl mb-4 animate-pulse">🔐</div>
                            <h3 class="text-xl font-bold mb-2">امنیت کامل</h3>
                            <p class="text-sm opacity-90">رمزگذاری پیشرفته</p>
                        </div>
                        <div class="text-center p-6 bg-white/10 backdrop-blur-sm rounded-xl border border-white/20">
                            <div class="text-4xl mb-4 animate-pulse">🌐</div>
                            <h3 class="text-xl font-bold mb-2">دسترسی آزاد</h3>
                            <p class="text-sm opacity-90">بدون محدودیت جغرافیایی</p>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <a href="https://t.me/Academi_Conectix_bot" target="_blank" rel="noopener noreferrer" 
                           class="bg-white text-blue-600 px-10 py-5 rounded-2xl font-bold hover:bg-gray-100 transition-all inline-flex items-center space-x-3 space-x-reverse shadow-2xl hover:shadow-3xl transform hover:scale-105">
                            <span class="text-2xl">🤖</span>
                            <span class="text-lg">خرید و تست رایگان</span>
                        </a>
                        <p class="text-sm mt-4 opacity-75">⭐ بیش از 10,000 کاربر راضی</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- DNS Management Section -->
        <div id="dnsSection" class="section hidden">
            <div class="text-center mb-8 animate-bounce-in">
                <div class="text-6xl mb-4">🔧</div>
                <h2 class="text-4xl font-bold mb-4 gradient-text">مدیریت DNS</h2>
            </div>

            <!-- DNS Type Selection -->
            <div class="card p-8 rounded-2xl mb-8 animate-fade-in-up">
                <h3 class="text-2xl font-bold mb-6 text-center">نوع DNS مورد نظر را انتخاب کنید:</h3>
                
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <button onclick="showDNSOptions('create')" class="card p-6 rounded-xl hover:scale-105 transition-all">
                        <div class="text-4xl mb-4 text-center">🛠️</div>
                        <h4 class="text-xl font-bold mb-2 text-center">ساخت DNS جدید</h4>
                        <p class="text-center opacity-75">ساخت DNS های جدید از سرورهای ایرانی</p>
                    </button>
                    
                    <button onclick="showDNSOptions('global')" class="card p-6 rounded-xl hover:scale-105 transition-all">
                        <div class="text-4xl mb-4 text-center">🌍</div>
                        <h4 class="text-xl font-bold mb-2 text-center">سرورهای جهانی</h4>
                        <p class="text-center opacity-75">استفاده از بهترین DNS های جهانی</p>
                    </button>
                </div>
            </div>

            <!-- DNS Options -->
            <div id="dnsOptions" class="hidden"></div>
            
            <!-- DNS Results -->
            <div id="dnsResults" class="hidden"></div>
        </div>

        <!-- Speed Test Section -->
        <div id="speedSection" class="section hidden">
            <div class="text-center mb-8 animate-bounce-in">
                <div class="text-6xl mb-4">⚡</div>
                <h2 class="text-4xl font-bold mb-4 gradient-text">تست سرعت اینترنت</h2>
            </div>

            <div class="card p-8 rounded-2xl mb-8 animate-fade-in-up">
                <div class="text-center mb-8">
                    <div class="speed-gauge mb-6">
                        <div class="speed-needle" id="speedNeedle"></div>
                        <div class="speed-center"></div>
                    </div>
                    <div id="speedResult" class="text-3xl font-bold mb-4">-- Mbps</div>
                    <div class="grid md:grid-cols-3 gap-4 mb-6 text-sm">
                        <div>
                            <div class="opacity-75">دانلود</div>
                            <div id="downloadSpeed" class="font-bold">-- Mbps</div>
                        </div>
                        <div>
                            <div class="opacity-75">آپلود</div>
                            <div id="uploadSpeed" class="font-bold">-- Mbps</div>
                        </div>
                        <div>
                            <div class="opacity-75">پینگ</div>
                            <div id="pingSpeed" class="font-bold">-- ms</div>
                        </div>
                    </div>
                    <button onclick="startSpeedTest()" id="speedTestBtn" class="btn-primary px-8 py-4 rounded-xl font-bold">
                        🚀 شروع تست
                    </button>
                </div>
            </div>

            <!-- Speed Test History -->
            <div class="card p-8 rounded-2xl animate-fade-in-up">
                <h3 class="text-2xl font-bold mb-6">📊 تاریخچه تست‌ها</h3>
                <div id="speedHistory" class="space-y-4">
                    <div class="text-center opacity-75 py-8">
                        <div class="text-4xl mb-4">📈</div>
                        <p>هنوز تستی انجام نشده است</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tools Section -->
        <div id="toolsSection" class="section hidden">
            <div class="text-center mb-8 animate-bounce-in">
                <div class="text-6xl mb-4">🛠️</div>
                <h2 class="text-4xl font-bold mb-4 gradient-text">ابزارهای پیشرفته</h2>
                <p class="text-lg opacity-75">ابزارهای قدرتمند برای تحلیل و بهینه‌سازی DNS</p>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <!-- DNS Lookup Tool -->
                <div class="card p-8 rounded-2xl animate-fade-in-up">
                    <h3 class="text-2xl font-bold mb-6">🔍 DNS Lookup</h3>
                    <div class="space-y-4">
                        <input type="text" id="lookupDomain" placeholder="نام دامنه را وارد کنید" 
                               class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                        <button onclick="performDNSLookup()" class="btn-primary px-6 py-3 rounded-lg w-full">
                            🔍 جستجو
                        </button>
                        <div id="lookupResults" class="mt-4 p-4 rounded-lg" style="background: var(--bg-tertiary); display: none;">
                            <h4 class="font-bold mb-2">نتایج:</h4>
                            <div id="lookupContent"></div>
                        </div>
                    </div>
                </div>

                <!-- DNS Flush Tool -->
                <div class="card p-8 rounded-2xl animate-fade-in-up">
                    <h3 class="text-2xl font-bold mb-6">🧹 پاک‌سازی DNS Cache</h3>
                    <div class="space-y-4">
                        <p class="opacity-75">پاک‌سازی کش DNS برای حل مشکلات اتصال</p>
                        <button onclick="flushDNSCache()" class="btn-primary px-6 py-3 rounded-lg w-full">
                            🧹 پاک‌سازی کش
                        </button>
                        <div class="text-sm opacity-75 mt-4">
                            <p>⚠️ این عملیات ممکن است نیاز به دسترسی مدیریتی داشته باشد</p>
                        </div>
                    </div>
                </div>

                <!-- Network Diagnostics -->
                <div class="card p-8 rounded-2xl animate-fade-in-up">
                    <h3 class="text-2xl font-bold mb-6">🩺 تشخیص شبکه</h3>
                    <div class="space-y-4">
                        <button onclick="runNetworkDiagnostics()" class="btn-primary px-6 py-3 rounded-lg w-full">
                            🩺 شروع تشخیص
                        </button>
                        <div id="diagnosticsResults" class="space-y-2 mt-4"></div>
                    </div>
                </div>

                <!-- DNS Security Check -->
                <div class="card p-8 rounded-2xl animate-fade-in-up">
                    <h3 class="text-2xl font-bold mb-6">🔒 بررسی امنیت DNS</h3>
                    <div class="space-y-4">
                        <button onclick="checkDNSSecurity()" class="btn-primary px-6 py-3 rounded-lg w-full">
                            🔒 بررسی امنیت
                        </button>
                        <div id="securityResults" class="space-y-2 mt-4"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ping Section -->
        <div id="pingSection" class="section hidden">
            <div class="text-center mb-8 animate-bounce-in">
                <div class="text-6xl mb-4">📊</div>
                <h2 class="text-4xl font-bold mb-4 gradient-text">پینگ DNS</h2>
                <p class="text-lg opacity-75">بررسی سرعت پاسخ DNS های مختلف</p>
            </div>

            <!-- DNS Ping Test -->
            <div class="card p-8 rounded-2xl mb-8 animate-fade-in-up">
                <h3 class="text-2xl font-bold mb-6">🎯 تست پینگ DNS</h3>
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block font-medium mb-2">DNS سرور:</label>
                        <select id="pingDNSServer" class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                            <option value="1.1.1.1">Cloudflare (1.1.1.1)</option>
                            <option value="8.8.8.8">Google (8.8.8.8)</option>
                            <option value="9.9.9.9">Quad9 (9.9.9.9)</option>
                            <option value="208.67.222.222">OpenDNS (208.67.222.222)</option>
                            <option value="custom">سفارشی</option>
                        </select>
                    </div>
                    <div>
                        <label class="block font-medium mb-2">تعداد پینگ:</label>
                        <select id="pingCount" class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                            <option value="4">4 پینگ</option>
                            <option value="10">10 پینگ</option>
                            <option value="20">20 پینگ</option>
                            <option value="continuous">مداوم</option>
                        </select>
                    </div>
                </div>
                <div id="customDNSInput" class="mb-6 hidden">
                    <input type="text" id="customDNS" placeholder="آدرس DNS سفارشی را وارد کنید" 
                           class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                </div>
                <button onclick="startPingTest()" id="pingTestBtn" class="btn-primary px-8 py-4 rounded-xl font-bold w-full">
                    📊 شروع تست پینگ
                </button>
            </div>

            <!-- Ping Results -->
            <div id="pingResults" class="hidden">
                <div class="card p-8 rounded-2xl animate-fade-in-up">
                    <h3 class="text-2xl font-bold mb-6">📈 نتایج پینگ</h3>
                    <div id="pingChart" class="mb-6 text-center"></div>
                    <div id="pingStats" class="grid md:grid-cols-4 gap-4"></div>
                </div>
            </div>
        </div>

        <!-- Compare Section -->
        <div id="compareSection" class="section hidden">
            <div class="text-center mb-8 animate-bounce-in">
                <div class="text-6xl mb-4">⚖️</div>
                <h2 class="text-4xl font-bold mb-4 gradient-text">مقایسه DNS</h2>
                <p class="text-lg opacity-75">مقایسه جامع DNS های مختلف</p>
            </div>

            <!-- DNS Comparison Tool -->
            <div class="card p-8 rounded-2xl mb-8 animate-fade-in-up">
                <h3 class="text-2xl font-bold mb-6">🔄 مقایسه DNS ها</h3>
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block font-medium mb-2">DNS اول:</label>
                        <input type="text" id="dns1" placeholder="مثال: 1.1.1.1" 
                               class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block font-medium mb-2">DNS دوم:</label>
                        <input type="text" id="dns2" placeholder="مثال: 8.8.8.8" 
                               class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                    </div>
                </div>
                <button onclick="compareDNS()" class="btn-primary px-8 py-4 rounded-xl font-bold w-full">
                    ⚖️ شروع مقایسه
                </button>
            </div>

            <!-- Comparison Results -->
            <div id="comparisonResults" class="hidden">
                <div class="card p-8 rounded-2xl animate-fade-in-up">
                    <h3 class="text-2xl font-bold mb-6">📊 نتایج مقایسه</h3>
                    <div id="comparisonTable" class="overflow-x-auto"></div>
                </div>
            </div>
        </div>

        <!-- Education Section -->
        <div id="educationSection" class="section hidden">
            <div class="text-center mb-8 animate-bounce-in">
                <div class="text-6xl mb-4">📚</div>
                <h2 class="text-4xl font-bold mb-4 gradient-text">آموزش DNS</h2>
                <p class="text-lg opacity-75">یادگیری کامل مفاهیم و تنظیمات DNS</p>
            </div>

            <!-- Education Tabs -->
            <div class="card p-8 rounded-2xl mb-8 animate-fade-in-up">
                <div class="flex flex-wrap gap-4 mb-8">
                    <button onclick="showEducationTab('basics')" class="tab-button active" id="basicsTab">
                        🎯 مبانی DNS
                    </button>
                    <button onclick="showEducationTab('setup')" class="tab-button" id="setupTab">
                        ⚙️ نحوه تنظیم
                    </button>
                    <button onclick="showEducationTab('troubleshooting')" class="tab-button" id="troubleshootingTab">
                        🔧 عیب‌یابی
                    </button>
                    <button onclick="showEducationTab('security')" class="tab-button" id="securityTab">
                        🔒 امنیت
                    </button>
                </div>

                <div id="educationContent">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Profile Section -->
        <div id="profileSection" class="section hidden">
            <div class="text-center mb-8 animate-bounce-in">
                <div class="text-6xl mb-4">👤</div>
                <h2 class="text-4xl font-bold mb-4 gradient-text">پنل کاربری</h2>
                <p class="text-lg opacity-75">مدیریت حساب کاربری و تنظیمات شخصی</p>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <!-- Account Management -->
                <div class="card p-8 rounded-2xl animate-fade-in-up">
                    <h3 class="text-2xl font-bold mb-6">👤 مدیریت حساب</h3>
                    <div class="space-y-6">
                        <div class="p-4 rounded-lg" style="background: var(--bg-tertiary);">
                            <div class="flex items-center space-x-3 space-x-reverse mb-4">
                                <span class="text-2xl">👤</span>
                                <div>
                                    <div class="font-bold" id="currentUserName">نام کاربر</div>
                                    <div class="text-sm opacity-75" id="currentUsername">@username</div>
                                </div>
                            </div>
                            <div class="text-xs opacity-50">عضو از: <span id="memberSince">امروز</span></div>
                        </div>
                        
                        <div class="space-y-4">
                            <button onclick="showEditProfileModal()" class="btn-primary px-6 py-3 rounded-lg w-full">
                                ✏️ ویرایش اطلاعات
                            </button>
                            <button onclick="showChangePasswordModal()" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-lg w-full transition-all">
                                🔐 تغییر رمز عبور
                            </button>
                            <button onclick="deleteAccount()" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg w-full transition-all">
                                🗑️ حذف حساب کاربری
                            </button>
                        </div>
                    </div>
                </div>

                <!-- User Statistics -->
                <div class="card p-8 rounded-2xl animate-fade-in-up">
                    <h3 class="text-2xl font-bold mb-6">📊 آمار کاربری</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-4 rounded-lg" style="background: var(--bg-tertiary);">
                            <span>تعداد تست‌های انجام شده:</span>
                            <span class="font-bold text-blue-500" id="profileTotalTests">0</span>
                        </div>
                        <div class="flex justify-between items-center p-4 rounded-lg" style="background: var(--bg-tertiary);">
                            <span>DNS های ذخیره شده:</span>
                            <span class="font-bold text-green-500" id="profileSavedDNS">0</span>
                        </div>
                        <div class="flex justify-between items-center p-4 rounded-lg" style="background: var(--bg-tertiary);">
                            <span>بهترین سرعت:</span>
                            <span class="font-bold text-purple-500" id="profileBestSpeed">0 Mbps</span>
                        </div>
                        <div class="flex justify-between items-center p-4 rounded-lg" style="background: var(--bg-tertiary);">
                            <span>بهترین پینگ:</span>
                            <span class="font-bold text-orange-500" id="profileBestPing">∞ ms</span>
                        </div>
                    </div>
                </div>

                <!-- User Preferences -->
                <div class="card p-8 rounded-2xl animate-fade-in-up">
                    <h3 class="text-2xl font-bold mb-6">⚙️ تنظیمات</h3>
                    <div class="space-y-6">
                        <div class="flex justify-between items-center">
                            <span>تم خودکار:</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="autoTheme" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        <div class="flex justify-between items-center">
                            <span>انیمیشن‌ها:</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="animations" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        <div class="flex justify-between items-center">
                            <span>اعلان‌های تست:</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="testNotifications" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        <div class="flex justify-between items-center">
                            <span>پیشنهادات هوشمند:</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="smartSuggestions" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        <button onclick="saveUserPreferences()" class="btn-primary px-6 py-3 rounded-lg w-full">
                            💾 ذخیره تنظیمات
                        </button>
                    </div>
                </div>

                <!-- Saved DNS List -->
                <div class="card p-8 rounded-2xl animate-fade-in-up">
                    <h3 class="text-2xl font-bold mb-6">💾 DNS های ذخیره شده</h3>
                    <div id="savedDNSList" class="space-y-4 max-h-96 overflow-y-auto">
                        <div class="text-center opacity-75 py-8">
                            <div class="text-4xl mb-4">📝</div>
                            <p>هنوز DNS ای ذخیره نشده است</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Section -->
        <div id="aiSection" class="section hidden">
            <div class="text-center mb-8 animate-bounce-in">
                <div class="text-6xl mb-4">🤖</div>
                <h2 class="text-4xl font-bold mb-4 gradient-text">هوش مصنوعی DNS</h2>
                <p class="text-lg opacity-75">بهینه‌سازی هوشمند و خودکار DNS</p>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <!-- AI DNS Optimizer -->
                <div class="card p-8 rounded-2xl animate-fade-in-up">
                    <h3 class="text-2xl font-bold mb-6">🧠 بهینه‌ساز هوشمند</h3>
                    <div class="space-y-4">
                        <p class="opacity-75">هوش مصنوعی بهترین DNS را برای شما پیدا می‌کند</p>
                        <div class="space-y-2">
                            <label class="block font-medium">نوع کاربری:</label>
                            <select id="aiUsageType" class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                                <option value="gaming">🎮 گیمینگ</option>
                                <option value="streaming">📺 استریمینگ</option>
                                <option value="work">💼 کاری</option>
                                <option value="general">🌐 عمومی</option>
                            </select>
                        </div>
                        <button onclick="startAIOptimization()" class="btn-primary px-6 py-3 rounded-lg w-full">
                            🚀 شروع بهینه‌سازی
                        </button>
                        <div id="aiResults" class="mt-4 p-4 rounded-lg hidden" style="background: var(--bg-tertiary);">
                            <div id="aiContent"></div>
                        </div>
                    </div>
                </div>

                <!-- Auto DNS Switcher -->
                <div class="card p-8 rounded-2xl animate-fade-in-up">
                    <h3 class="text-2xl font-bold mb-6">🔄 تعویض خودکار DNS</h3>
                    <div class="space-y-4">
                        <p class="opacity-75">تعویض خودکار DNS بر اساس شرایط شبکه</p>
                        <div class="flex justify-between items-center p-4 rounded-lg" style="background: var(--bg-tertiary);">
                            <span>وضعیت:</span>
                            <span id="autoSwitcherStatusText" class="font-bold text-red-500">خاموش</span>
                        </div>
                        <button onclick="toggleAutoSwitcher()" id="autoSwitcherBtn" class="btn-primary px-6 py-3 rounded-lg w-full">
                            🔄 فعال‌سازی تعویض خودکار
                        </button>
                        <div class="text-sm opacity-75">
                            <p>⚡ تعویض خودکار بر اساس سرعت و پینگ</p>
                            <p>🔒 حفظ امنیت در اولویت</p>
                        </div>
                    </div>
                </div>

                <!-- AI Chat Assistant -->
                <div class="card p-8 rounded-2xl animate-fade-in-up md:col-span-2">
                    <h3 class="text-2xl font-bold mb-6">💬 دستیار هوشمند DNS</h3>
                    <div class="space-y-4">
                        <div id="chatMessages" class="h-64 overflow-y-auto p-4 rounded-lg space-y-2" style="background: var(--bg-tertiary);">
                            <div class="flex items-start space-x-3 space-x-reverse">
                                <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm">🤖</div>
                                <div class="bg-blue-100 text-blue-900 p-3 rounded-lg max-w-xs">
                                    سلام! من دستیار هوشمند DNS هستم. چطور می‌تونم کمکتون کنم؟
                                </div>
                            </div>
                        </div>
                        <div class="flex space-x-2 space-x-reverse">
                            <input type="text" id="chatInput" placeholder="سوال خود را بپرسید..." 
                                   class="flex-1 p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none"
                                   onkeypress="if(event.key==='Enter') sendChatMessage()">
                            <button onclick="sendChatMessage()" class="btn-primary px-6 py-3 rounded-lg">
                                📤 ارسال
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Section -->
        <div id="adminSection" class="section hidden">
            <div class="text-center mb-8 animate-bounce-in">
                <div class="text-6xl mb-4">👑</div>
                <h2 class="text-4xl font-bold mb-4 gradient-text">پنل مدیریت</h2>
                <p class="text-lg opacity-75">مدیریت کاربران و تنظیمات سیستم</p>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <!-- Global Message Management -->
                <div class="card p-8 rounded-2xl animate-fade-in-up">
                    <h3 class="text-2xl font-bold mb-6">📢 مدیریت پیام همگانی</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block font-medium mb-2">پیام همگانی:</label>
                            <textarea id="globalMessageInput" rows="4" placeholder="پیام خود را وارد کنید..." 
                                      class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none resize-none"></textarea>
                        </div>
                        
                        <div class="flex space-x-4 space-x-reverse">
                            <button onclick="sendGlobalMessage()" class="btn-primary px-6 py-3 rounded-lg flex-1">
                                📤 ارسال پیام
                            </button>
                            <button onclick="clearGlobalMessage()" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg flex-1 transition-all">
                                🗑️ حذف پیام
                            </button>
                        </div>
                        
                        <div id="currentGlobalMessage" class="p-4 rounded-lg hidden" style="background: var(--bg-tertiary);">
                            <h4 class="font-bold mb-2">پیام فعلی:</h4>
                            <div id="currentMessageContent" class="text-sm opacity-75"></div>
                            <div id="currentMessageDate" class="text-xs opacity-50 mt-2"></div>
                        </div>
                    </div>
                </div>

                <!-- User Management -->
                <div class="card p-8 rounded-2xl animate-fade-in-up">
                    <h3 class="text-2xl font-bold mb-6">👥 مدیریت کاربران</h3>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="text-center p-4 rounded-lg" style="background: var(--bg-tertiary);">
                                <div class="text-2xl font-bold text-blue-500" id="totalUsers">0</div>
                                <div class="text-sm opacity-75">کل کاربران</div>
                            </div>
                            <div class="text-center p-4 rounded-lg" style="background: var(--bg-tertiary);">
                                <div class="text-2xl font-bold text-green-500" id="onlineUsers">0</div>
                                <div class="text-sm opacity-75">آنلاین</div>
                            </div>
                        </div>
                        
                        <div class="flex space-x-4 space-x-reverse">
                            <button onclick="refreshUserStats()" class="btn-primary px-6 py-3 rounded-lg flex-1">
                                🔄 بروزرسانی آمار
                            </button>
                            <button onclick="deleteAllUsers()" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg flex-1 transition-all">
                                🗑️ حذف همه کاربران
                            </button>
                        </div>
                        
                        <div id="usersList" class="max-h-64 overflow-y-auto space-y-2">
                            <!-- Users will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- System Statistics -->
                <div class="card p-8 rounded-2xl animate-fade-in-up">
                    <h3 class="text-2xl font-bold mb-6">📊 آمار سیستم</h3>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="text-center p-4 rounded-lg" style="background: var(--bg-tertiary);">
                                <div class="text-2xl font-bold text-purple-500" id="totalSystemTests">0</div>
                                <div class="text-sm opacity-75">کل تست‌ها</div>
                            </div>
                            <div class="text-center p-4 rounded-lg" style="background: var(--bg-tertiary);">
                                <div class="text-2xl font-bold text-orange-500" id="totalDNSGenerated">0</div>
                                <div class="text-sm opacity-75">DNS تولید شده</div>
                            </div>
                        </div>
                        
                        <div class="p-4 rounded-lg" style="background: var(--bg-tertiary);">
                            <h4 class="font-bold mb-2">آخرین فعالیت‌ها:</h4>
                            <div id="recentActivities" class="text-sm space-y-1 max-h-32 overflow-y-auto">
                                <!-- Activities will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Tools -->
                <div class="card p-8 rounded-2xl animate-fade-in-up">
                    <h3 class="text-2xl font-bold mb-6">🛠️ ابزارهای مدیریت</h3>
                    <div class="space-y-4">
                        <button onclick="clearAllUserData()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-3 rounded-lg w-full transition-all">
                            🧹 پاک‌سازی داده‌ها
                        </button>
                        <button onclick="exportUserData()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg w-full transition-all">
                            📥 خروجی داده‌ها
                        </button>
                        <button onclick="systemMaintenance()" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-lg w-full transition-all">
                            ⚙️ تعمیر و نگهداری
                        </button>
                        <button onclick="generateSystemReport()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg w-full transition-all">
                            📋 گزارش سیستم
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Section -->
        <div id="aboutSection" class="section hidden">
            <div class="text-center mb-8 animate-bounce-in">
                <div class="text-6xl mb-4">ℹ️</div>
                <h2 class="text-4xl font-bold mb-4 gradient-text">درباره ما</h2>
            </div>

            <div class="card p-8 rounded-2xl animate-fade-in-up">
                <div class="text-center mb-8">
                    <h3 class="text-2xl font-bold mb-4">Academi DNS Manager</h3>
                    <p class="text-lg opacity-75 mb-6">ابزار پیشرفته مدیریت DNS با قابلیت‌های هوش مصنوعی</p>
                </div>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h4 class="text-xl font-bold mb-4">ویژگی‌ها:</h4>
                        <ul class="space-y-2 opacity-75">
                            <li>✅ ساخت DNS های جدید</li>
                            <li>✅ دسترسی به DNS های جهانی</li>
                            <li>✅ تست سرعت پیشرفته</li>
                            <li>✅ بررسی پینگ و امنیت</li>
                            <li>✅ مقایسه DNS های مختلف</li>
                            <li>✅ آموزش کامل DNS</li>
                            <li>✅ پنل کاربری شخصی</li>
                            <li>✅ هوش مصنوعی و بهینه‌سازی خودکار</li>
                            <li>✅ تحلیل‌های پیشرفته</li>
                            <li>✅ رابط کاربری زیبا و کاربردی</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="text-xl font-bold mb-4">ارتباط با ما:</h4>
                        <div class="space-y-4">
                            <a href="https://t.me/Academi_vpn" target="_blank" rel="noopener noreferrer" 
                               class="block btn-primary px-6 py-3 rounded-lg text-center">
                                📢 کانال تلگرام
                            </a>
                            <a href="https://t.me/MahdiAGM0" target="_blank" rel="noopener noreferrer" 
                               class="block btn-primary px-6 py-3 rounded-lg text-center">
                                💬 پشتیبانی
                            </a>
                            <div class="text-center mt-6">
                                <p class="text-sm opacity-75">نسخه 2.0.0 - آپدیت شده در آذر 1403</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="card p-8 rounded-2xl max-w-md w-full mx-4 animate-bounce-in">
            <div class="text-center mb-6">
                <div class="text-4xl mb-4">✏️</div>
                <h2 class="text-2xl font-bold">ویرایش اطلاعات</h2>
            </div>
            
            <form id="editProfileForm" class="space-y-4">
                <div>
                    <label class="block font-medium mb-2">نام:</label>
                    <input type="text" id="editName" required 
                           class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                </div>
                
                <div>
                    <label class="block font-medium mb-2">نام کاربری:</label>
                    <input type="text" id="editUsername" required 
                           class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                </div>
                
                <div class="flex space-x-4 space-x-reverse">
                    <button type="submit" class="btn-primary px-6 py-3 rounded-lg flex-1">
                        💾 ذخیره تغییرات
                    </button>
                    <button type="button" onclick="closeEditProfileModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg flex-1 transition-all">
                        ❌ لغو
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="card p-8 rounded-2xl max-w-md w-full mx-4 animate-bounce-in">
            <div class="text-center mb-6">
                <div class="text-4xl mb-4">🔐</div>
                <h2 class="text-2xl font-bold">تغییر رمز عبور</h2>
            </div>
            
            <form id="changePasswordForm" class="space-y-4">
                <div>
                    <label class="block font-medium mb-2">رمز عبور فعلی:</label>
                    <input type="password" id="currentPassword" required 
                           class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                </div>
                
                <div>
                    <label class="block font-medium mb-2">رمز عبور جدید:</label>
                    <input type="password" id="newPassword" required 
                           class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                </div>
                
                <div>
                    <label class="block font-medium mb-2">تکرار رمز عبور جدید:</label>
                    <input type="password" id="confirmNewPassword" required 
                           class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                </div>
                
                <div class="flex space-x-4 space-x-reverse">
                    <button type="submit" class="btn-primary px-6 py-3 rounded-lg flex-1">
                        🔐 تغییر رمز عبور
                    </button>
                    <button type="button" onclick="closeChangePasswordModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg flex-1 transition-all">
                        ❌ لغو
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global Variables
        let currentTheme = 'light';
        let currentSpeed = 0;
        let autoSwitcherActive = false;
        let continuousPingActive = false;
        let currentUser = null;
        let currentCaptcha = '';
        let userData = {
            totalTests: 0,
            savedDNS: [],
            testHistory: [],
            bestSpeed: 0,
            bestPing: Infinity,
            preferences: {
                autoTheme: false,
                animations: true,
                testNotifications: true,
                smartSuggestions: true
            }
        };

        // Admin credentials (hidden from users)
        const ADMIN_CREDENTIALS = {
            username: 'academi_admin_2024',
            password: 'DNS_Manager_Admin_@2024!'
        };

        // System data
        let systemData = {
            totalTests: 0,
            totalDNSGenerated: 0,
            activities: []
        };
        
        // Iranian IP ranges for DNS generation
        const iranIPRanges = [
            '5.63.0.0/16', '31.2.0.0/16', '37.98.0.0/16', '37.156.0.0/16',
            '46.32.0.0/16', '62.193.0.0/16', '78.39.0.0/16', '79.175.0.0/16',
            '85.15.0.0/16', '91.98.0.0/16', '92.42.0.0/16', '94.182.0.0/16',
            '151.232.0.0/16', '178.22.0.0/16', '185.8.0.0/16', '188.0.0.0/16'
        ];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            console.log('🚀 Initializing Academi DNS Manager...');
            
            // Load user data first
            loadUserData();
            loadSystemData();
            
            // Check if user is logged in
            checkUserLogin();
            
            // Setup all event listeners
            setupEventListeners();
            
            // Update UI with loaded data
            updateStatistics();
            
            // Show home section by default
            showSection('home');
            
            console.log('✅ App initialized successfully!');
        }

        function loadUserData() {
            if (currentUser && currentUser.id) {
                // Load user-specific data
                const saved = localStorage.getItem(`dnsManagerUserData_${currentUser.id}`);
                if (saved) {
                    userData = { ...userData, ...JSON.parse(saved) };
                }
            } else {
                // Fallback for anonymous users
                const saved = localStorage.getItem('dnsManagerUserData');
                if (saved) {
                    userData = { ...userData, ...JSON.parse(saved) };
                }
            }
        }

        function saveUserData() {
            if (currentUser && currentUser.id) {
                // Save user-specific data with user ID
                localStorage.setItem(`dnsManagerUserData_${currentUser.id}`, JSON.stringify(userData));
            } else {
                // Fallback for anonymous users
                localStorage.setItem('dnsManagerUserData', JSON.stringify(userData));
            }
        }

        function setupEventListeners() {
            // Theme toggle
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    currentTheme = currentTheme === 'light' ? 'dark' : 'light';
                    document.body.className = currentTheme;
                    document.getElementById('themeIcon').textContent = currentTheme === 'light' ? '🌙' : '☀️';
                });
            }

            // Hamburger menu - Fixed implementation
            setupHamburgerMenu();

            // Button click handlers
            document.querySelectorAll('button[data-section]').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const section = this.getAttribute('data-section');
                    console.log('Button clicked:', section);
                    if (section) {
                        showSection(section);
                    }
                });
            });

            // Ping DNS server selection
            const pingDNSServer = document.getElementById('pingDNSServer');
            if (pingDNSServer) {
                pingDNSServer.addEventListener('change', function() {
                    const customInput = document.getElementById('customDNSInput');
                    if (customInput) {
                        if (this.value === 'custom') {
                            customInput.classList.remove('hidden');
                        } else {
                            customInput.classList.add('hidden');
                        }
                    }
                });
            }

            // Authentication form handlers
            setupAuthenticationHandlers();
        }

        function setupAuthenticationHandlers() {
            // Login form
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleLogin();
                });
            }

            // Register form
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleRegister();
                });
            }

            // Edit profile form
            const editProfileForm = document.getElementById('editProfileForm');
            if (editProfileForm) {
                editProfileForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleEditProfile();
                });
            }

            // Change password form
            const changePasswordForm = document.getElementById('changePasswordForm');
            if (changePasswordForm) {
                changePasswordForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleChangePassword();
                });
            }
        }

        // Authentication Functions
        function checkUserLogin() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateUserInterface();
            }
        }

        function updateUserInterface() {
            const loggedOutPanel = document.getElementById('loggedOutPanel');
            const loggedInPanel = document.getElementById('loggedInPanel');
            const userDisplayName = document.getElementById('userDisplayName');
            const adminMenuItem = document.getElementById('adminMenuItem');

            if (currentUser) {
                loggedOutPanel.classList.add('hidden');
                loggedInPanel.classList.remove('hidden');
                userDisplayName.textContent = currentUser.name;
                
                // Load user-specific data after login
                loadUserData();
                updateStatistics();
                
                // Check if user is admin
                if (isAdmin()) {
                    adminMenuItem.style.display = 'block';
                } else {
                    adminMenuItem.style.display = 'none';
                }
                
                // Update profile section
                document.getElementById('currentUserName').textContent = currentUser.name;
                document.getElementById('currentUsername').textContent = '@' + currentUser.username;
                document.getElementById('memberSince').textContent = currentUser.joinDate || 'امروز';
            } else {
                loggedOutPanel.classList.remove('hidden');
                loggedInPanel.classList.add('hidden');
                adminMenuItem.style.display = 'none';
                
                // Reset to default user data for anonymous users
                userData = {
                    totalTests: 0,
                    savedDNS: [],
                    testHistory: [],
                    bestSpeed: 0,
                    bestPing: Infinity,
                    preferences: {
                        autoTheme: false,
                        animations: true,
                        testNotifications: true,
                        smartSuggestions: true
                    }
                };
                updateStatistics();
            }

            // Load and show global message
            loadGlobalMessage();
        }

        function isAdmin() {
            return currentUser && 
                   (currentUser.isAdmin === true || 
                   (currentUser.username === ADMIN_CREDENTIALS.username && 
                    currentUser.password === ADMIN_CREDENTIALS.password));
        }

        function loadGlobalMessage() {
            const globalMessage = localStorage.getItem('globalMessage');
            if (globalMessage) {
                const messageData = JSON.parse(globalMessage);
                showGlobalMessageBanner(messageData.content, messageData.date);
            }
        }

        function showGlobalMessageBanner(content, date) {
            const banner = document.getElementById('globalMessageBanner');
            const contentEl = document.getElementById('globalMessageContent');
            const dateEl = document.getElementById('globalMessageDate');
            
            contentEl.textContent = content;
            dateEl.textContent = new Date(date).toLocaleDateString('fa-IR');
            banner.classList.remove('hidden');
        }

        function hideGlobalMessageBanner() {
            const banner = document.getElementById('globalMessageBanner');
            banner.classList.add('hidden');
        }

        function showLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('loginForm').reset();
        }

        function showRegisterModal() {
            document.getElementById('registerModal').classList.remove('hidden');
            generateCaptcha();
        }

        function closeRegisterModal() {
            document.getElementById('registerModal').classList.add('hidden');
            document.getElementById('registerForm').reset();
        }

        function generateCaptcha() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            currentCaptcha = '';
            for (let i = 0; i < 5; i++) {
                currentCaptcha += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            document.getElementById('captchaDisplay').textContent = currentCaptcha;
        }

        function handleLogin() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            // Check if admin login
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                currentUser = {
                    id: 'admin',
                    name: 'مدیر سیستم',
                    username: ADMIN_CREDENTIALS.username,
                    password: ADMIN_CREDENTIALS.password,
                    isAdmin: true,
                    joinDate: 'مدیر سیستم'
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUserInterface();
                closeLoginModal();
                showNotification(`خوش آمدید مدیر محترم! 👑`, 'success');
                return;
            }

            // Get stored users
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const user = users.find(u => u.username === username && u.password === password);

            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUserInterface();
                closeLoginModal();
                showNotification(`خوش آمدید ${user.name}! 👋`, 'success');
            } else {
                showNotification('نام کاربری یا رمز عبور اشتباه است!', 'error');
            }
        }

        function handleRegister() {
            const name = document.getElementById('registerName').value;
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            const captchaInput = document.getElementById('captchaInput').value;

            // Validation
            if (password !== passwordConfirm) {
                showNotification('رمز عبور و تکرار آن یکسان نیستند!', 'error');
                return;
            }

            if (captchaInput.toUpperCase() !== currentCaptcha) {
                showNotification('کد امنیتی اشتباه است!', 'error');
                generateCaptcha();
                return;
            }

            if (password.length < 6) {
                showNotification('رمز عبور باید حداقل 6 کاراکتر باشد!', 'error');
                return;
            }

            // Check if username exists
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            if (users.find(u => u.username === username)) {
                showNotification('این نام کاربری قبلاً ثبت شده است!', 'error');
                return;
            }

            // Create new user
            const newUser = {
                id: Date.now(),
                name: name,
                username: username,
                password: password,
                joinDate: new Date().toLocaleDateString('fa-IR')
            };

            users.push(newUser);
            localStorage.setItem('registeredUsers', JSON.stringify(users));

            // Auto login
            currentUser = newUser;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            updateUserInterface();
            closeRegisterModal();
            showNotification(`حساب شما با موفقیت ایجاد شد! خوش آمدید ${name}! 🎉`, 'success');
        }

        function logoutUser() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            updateUserInterface();
            showNotification('با موفقیت خارج شدید! 👋', 'info');
            showSection('home');
        }

        function showEditProfileModal() {
            if (!currentUser) return;
            
            document.getElementById('editName').value = currentUser.name;
            document.getElementById('editUsername').value = currentUser.username;
            document.getElementById('editProfileModal').classList.remove('hidden');
        }

        function closeEditProfileModal() {
            document.getElementById('editProfileModal').classList.add('hidden');
            document.getElementById('editProfileForm').reset();
        }

        function handleEditProfile() {
            const newName = document.getElementById('editName').value;
            const newUsername = document.getElementById('editUsername').value;

            // Check if new username is taken by another user
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const existingUser = users.find(u => u.username === newUsername && u.id !== currentUser.id);
            
            if (existingUser) {
                showNotification('این نام کاربری توسط کاربر دیگری استفاده می‌شود!', 'error');
                return;
            }

            // Update user data
            currentUser.name = newName;
            currentUser.username = newUsername;

            // Update in storage
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('registeredUsers', JSON.stringify(users));
            }
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            updateUserInterface();
            closeEditProfileModal();
            showNotification('اطلاعات شما با موفقیت بروزرسانی شد! ✅', 'success');
        }

        function showChangePasswordModal() {
            if (!currentUser) return;
            document.getElementById('changePasswordModal').classList.remove('hidden');
        }

        function closeChangePasswordModal() {
            document.getElementById('changePasswordModal').classList.add('hidden');
            document.getElementById('changePasswordForm').reset();
        }

        function handleChangePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;

            if (currentPassword !== currentUser.password) {
                showNotification('رمز عبور فعلی اشتباه است!', 'error');
                return;
            }

            if (newPassword !== confirmNewPassword) {
                showNotification('رمز عبور جدید و تکرار آن یکسان نیستند!', 'error');
                return;
            }

            if (newPassword.length < 6) {
                showNotification('رمز عبور جدید باید حداقل 6 کاراکتر باشد!', 'error');
                return;
            }

            // Update password
            currentUser.password = newPassword;

            // Update in storage
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('registeredUsers', JSON.stringify(users));
            }
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            closeChangePasswordModal();
            showNotification('رمز عبور شما با موفقیت تغییر کرد! 🔐', 'success');
        }

        function deleteAccount() {
            if (!currentUser) return;

            if (confirm('آیا مطمئن هستید که می‌خواهید حساب کاربری خود را حذف کنید؟ این عمل قابل بازگشت نیست!')) {
                // Remove from users list
                const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                const filteredUsers = users.filter(u => u.id !== currentUser.id);
                localStorage.setItem('registeredUsers', JSON.stringify(filteredUsers));

                // Logout
                logoutUser();
                showNotification('حساب کاربری شما حذف شد! 🗑️', 'info');
            }
        }

        function setupHamburgerMenu() {
            const hamburger = document.getElementById('hamburger');
            const menuOverlay = document.getElementById('menuOverlay');
            
            console.log('Setting up hamburger menu...');
            console.log('Hamburger element:', hamburger);
            console.log('Menu overlay:', menuOverlay);
            
            if (!hamburger || !menuOverlay) {
                console.error('Hamburger menu elements not found!');
                return;
            }

            // Hamburger click handler
            hamburger.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Hamburger clicked - toggling menu');
                
                const isOpen = this.classList.contains('open');
                
                if (isOpen) {
                    this.classList.remove('open');
                    menuOverlay.classList.remove('active');
                    console.log('Menu closed');
                } else {
                    this.classList.add('open');
                    menuOverlay.classList.add('active');
                    console.log('Menu opened');
                }
            });

            // Menu overlay click handler (close when clicking outside menu items)
            menuOverlay.addEventListener('click', function(e) {
                if (e.target === this) {
                    console.log('Overlay clicked - closing menu');
                    hamburger.classList.remove('open');
                    this.classList.remove('active');
                }
            });

            // Menu items click handlers
            const menuItems = document.querySelectorAll('.menu-item');
            console.log('Found menu items:', menuItems.length);
            
            menuItems.forEach((item, index) => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const section = this.getAttribute('data-section');
                    console.log(`Menu item ${index + 1} clicked:`, section);
                    
                    if (section) {
                        // Close menu first
                        hamburger.classList.remove('open');
                        menuOverlay.classList.remove('active');
                        
                        // Then show section
                        setTimeout(() => {
                            showSection(section);
                        }, 100);
                    }
                });
            });

            // Close menu when pressing Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && menuOverlay.classList.contains('active')) {
                    hamburger.classList.remove('open');
                    menuOverlay.classList.remove('active');
                }
            });

            // Prevent menu from closing when clicking inside menu items area
            const menuItemsContainer = document.querySelector('.menu-items');
            if (menuItemsContainer) {
                menuItemsContainer.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
        }

        function updateStatistics() {
            document.getElementById('totalTests').textContent = userData.totalTests;
            document.getElementById('avgSpeed').textContent = userData.testHistory.length > 0 ? 
                Math.round(userData.testHistory.reduce((sum, test) => sum + test.speed, 0) / userData.testHistory.length) : 0;
            document.getElementById('bestPing').textContent = userData.bestPing === Infinity ? '∞' : userData.bestPing + 'ms';
            document.getElementById('savedDNS').textContent = userData.savedDNS.length;

            // Update profile statistics
            document.getElementById('profileTotalTests').textContent = userData.totalTests;
            document.getElementById('profileSavedDNS').textContent = userData.savedDNS.length;
            document.getElementById('profileBestSpeed').textContent = userData.bestSpeed + ' Mbps';
            document.getElementById('profileBestPing').textContent = userData.bestPing === Infinity ? '∞' : userData.bestPing + ' ms';

            // Update saved DNS list
            updateSavedDNSList();
        }

        function updateSavedDNSList() {
            const listContainer = document.getElementById('savedDNSList');
            if (userData.savedDNS.length === 0) {
                listContainer.innerHTML = `
                    <div class="text-center opacity-75 py-8">
                        <div class="text-4xl mb-4">📝</div>
                        <p>هنوز DNS ای ذخیره نشده است</p>
                    </div>
                `;
                return;
            }

            listContainer.innerHTML = userData.savedDNS.map((dns, index) => `
                <div class="dns-item card p-4 rounded-xl">
                    <div class="flex justify-between items-center">
                        <div>
                            <h4 class="font-bold">${dns.name}</h4>
                            <p class="text-sm opacity-75">${dns.primary} / ${dns.secondary}</p>
                            <p class="text-xs opacity-50">${dns.date}</p>
                        </div>
                        <div class="flex space-x-2 space-x-reverse">
                            <button onclick="copyDNS('${dns.primary}', '${dns.secondary}')" 
                                    class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm">
                                📋
                            </button>
                            <button onclick="deleteSavedDNS(${index})" 
                                    class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm">
                                🗑️
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function deleteSavedDNS(index) {
            userData.savedDNS.splice(index, 1);
            updateStatistics();
            saveUserData();
            showNotification('DNS حذف شد!', 'success');
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const content = document.getElementById('notificationContent');
            
            const icons = {
                success: '✅',
                error: '❌',
                warning: '⚠️',
                info: 'ℹ️'
            };
            
            content.innerHTML = `
                <div class="flex items-center space-x-3 space-x-reverse">
                    <span class="text-2xl">${icons[type]}</span>
                    <span>${message}</span>
                </div>
            `;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Navigation
        function showSection(sectionName) {
            console.log('Showing section:', sectionName);
            
            // Close menu
            const hamburger = document.getElementById('hamburger');
            const menuOverlay = document.getElementById('menuOverlay');
            
            if (hamburger) hamburger.classList.remove('open');
            if (menuOverlay) menuOverlay.classList.remove('active');
            
            // Check admin access
            if (sectionName === 'admin' && !isAdmin()) {
                showNotification('دسترسی غیرمجاز! فقط ادمین می‌تواند وارد این بخش شود.', 'error');
                return;
            }
            
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
                console.log('Section shown:', sectionName);
            } else {
                console.error('Section not found:', sectionName + 'Section');
            }

            // Load section-specific content
            if (sectionName === 'education') {
                setTimeout(() => showEducationTab('basics'), 100);
            } else if (sectionName === 'admin') {
                setTimeout(() => initializeAdminPanel(), 100);
            }
        }

        // Generate random Iranian IP
        function generateIranianIP() {
            const range = iranIPRanges[Math.floor(Math.random() * iranIPRanges.length)];
            const [baseIP, cidr] = range.split('/');
            const [a, b, c, d] = baseIP.split('.').map(Number);
            
            const randomC = c + Math.floor(Math.random() * 10);
            const randomD = Math.floor(Math.random() * 255);
            
            return `${a}.${b}.${randomC}.${randomD}`;
        }

        // DNS Management Functions
        function showDNSOptions(type) {
            const optionsDiv = document.getElementById('dnsOptions');
            
            if (type === 'create') {
                optionsDiv.innerHTML = `
                    <div class="card p-8 rounded-2xl animate-fade-in-up">
                        <h3 class="text-2xl font-bold mb-6">🛠️ ساخت DNS جدید</h3>
                        
                        <div class="grid md:grid-cols-3 gap-6 mb-6">
                            <div>
                                <label class="block font-medium mb-2">نوع کاربری:</label>
                                <select id="usageType" class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                                    <option value="">انتخاب کنید</option>
                                    <option value="gaming">🎮 گیمینگ</option>
                                    <option value="download">📥 دانلود</option>
                                    <option value="streaming">📺 استریمینگ</option>
                                    <option value="general">🌐 عمومی</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block font-medium mb-2">تعداد DNS:</label>
                                <select id="dnsCount" class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                                    <option value="2">2 DNS</option>
                                    <option value="4">4 DNS</option>
                                    <option value="6">6 DNS</option>
                                    <option value="8">8 DNS</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block font-medium mb-2">نوع IP:</label>
                                <select id="ipType" class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                                    <option value="ipv4">IPv4</option>
                                    <option value="ipv6">IPv6</option>
                                </select>
                            </div>
                        </div>
                        
                        <button onclick="generateNewDNS()" class="btn-primary px-8 py-4 rounded-xl font-bold w-full">
                            🚀 ساخت DNS جدید
                        </button>
                    </div>
                `;
            } else {
                optionsDiv.innerHTML = `
                    <div class="card p-8 rounded-2xl animate-fade-in-up">
                        <h3 class="text-2xl font-bold mb-6">🌍 سرورهای جهانی</h3>
                        
                        <div class="grid md:grid-cols-3 gap-6 mb-6">
                            <div>
                                <label class="block font-medium mb-2">نوع کاربری:</label>
                                <select id="globalUsageType" class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                                    <option value="gaming">🎮 گیمینگ</option>
                                    <option value="download">📥 دانلود</option>
                                    <option value="streaming">📺 استریمینگ</option>
                                    <option value="general">🌐 عمومی</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block font-medium mb-2">تعداد DNS:</label>
                                <select id="globalDnsCount" class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                                    <option value="2">2 DNS</option>
                                    <option value="4">4 DNS</option>
                                    <option value="6">6 DNS</option>
                                    <option value="8">8 DNS</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block font-medium mb-2">نوع IP:</label>
                                <select id="globalIpType" class="w-full p-3 rounded-lg border-2 border-gray-300 bg-white text-gray-900 focus:border-blue-500 focus:outline-none">
                                    <option value="ipv4">IPv4</option>
                                    <option value="ipv6">IPv6</option>
                                </select>
                            </div>
                        </div>
                        
                        <button onclick="getGlobalDNS()" class="btn-primary px-8 py-4 rounded-xl font-bold w-full">
                            🌍 دریافت DNS جهانی
                        </button>
                    </div>
                `;
            }
            
            optionsDiv.classList.remove('hidden');
        }

        function generateNewDNS() {
            const usageType = document.getElementById('usageType').value;
            const count = parseInt(document.getElementById('dnsCount').value);
            const ipType = document.getElementById('ipType').value;
            
            if (!usageType) {
                showNotification('لطفاً نوع کاربری را انتخاب کنید', 'warning');
                return;
            }
            
            const resultsDiv = document.getElementById('dnsResults');
            resultsDiv.innerHTML = `
                <div class="text-center card p-8 rounded-2xl">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-lg">در حال ساخت DNS های جدید...</p>
                </div>
            `;
            resultsDiv.classList.remove('hidden');
            
            setTimeout(() => {
                const dnsServers = [];
                
                for (let i = 0; i < count; i++) {
                    if (ipType === 'ipv4') {
                        dnsServers.push({
                            primary: generateIranianIP(),
                            secondary: generateIranianIP(),
                            ping: Math.floor(Math.random() * 50) + 10,
                            type: usageType
                        });
                    } else {
                        const hex = () => Math.floor(Math.random() * 65536).toString(16);
                        dnsServers.push({
                            primary: `2001:${hex()}:${hex()}::1`,
                            secondary: `2001:${hex()}:${hex()}::2`,
                            ping: Math.floor(Math.random() * 50) + 10,
                            type: usageType
                        });
                    }
                }
                
                displayDNSResults(dnsServers, 'ساخته شده');
                userData.totalTests++;
                updateStatistics();
                saveUserData();
            }, 3000);
        }

        function getGlobalDNS() {
            const usageType = document.getElementById('globalUsageType').value;
            const count = parseInt(document.getElementById('globalDnsCount').value);
            const ipType = document.getElementById('globalIpType').value;
            
            const resultsDiv = document.getElementById('dnsResults');
            resultsDiv.innerHTML = `
                <div class="text-center card p-8 rounded-2xl">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-lg">در حال دریافت بهترین DNS های جهانی...</p>
                </div>
            `;
            resultsDiv.classList.remove('hidden');
            
            setTimeout(() => {
                const globalServers = {
                    ipv4: {
                        gaming: [
                            { name: 'Cloudflare Gaming', primary: '1.1.1.1', secondary: '1.0.0.1', provider: 'Cloudflare' },
                            { name: 'Google Gaming', primary: '8.8.8.8', secondary: '8.8.4.4', provider: 'Google' },
                            { name: 'Level3 Gaming', primary: '4.2.2.1', secondary: '4.2.2.2', provider: 'Level3' },
                            { name: 'OpenDNS Gaming', primary: '208.67.222.222', secondary: '208.67.220.220', provider: 'OpenDNS' }
                        ],
                        download: [
                            { name: 'Cloudflare Fast', primary: '1.1.1.1', secondary: '1.0.0.1', provider: 'Cloudflare' },
                            { name: 'Google Fast', primary: '8.8.8.8', secondary: '8.8.4.4', provider: 'Google' },
                            { name: 'Quad9 Fast', primary: '9.9.9.9', secondary: '149.112.112.112', provider: 'Quad9' },
                            { name: 'AdGuard Fast', primary: '94.140.14.14', secondary: '94.140.15.15', provider: 'AdGuard' }
                        ],
                        streaming: [
                            { name: 'Google Stream', primary: '8.8.8.8', secondary: '8.8.4.4', provider: 'Google' },
                            { name: 'Cloudflare Stream', primary: '1.1.1.1', secondary: '1.0.0.1', provider: 'Cloudflare' },
                            { name: 'OpenDNS Stream', primary: '208.67.222.222', secondary: '208.67.220.220', provider: 'OpenDNS' },
                            { name: 'Yandex Stream', primary: '77.88.8.8', secondary: '77.88.8.1', provider: 'Yandex' }
                        ],
                        general: [
                            { name: 'Cloudflare Public', primary: '1.1.1.1', secondary: '1.0.0.1', provider: 'Cloudflare' },
                            { name: 'Google Public', primary: '8.8.8.8', secondary: '8.8.4.4', provider: 'Google' },
                            { name: 'Quad9 Secure', primary: '9.9.9.9', secondary: '149.112.112.112', provider: 'Quad9' },
                            { name: 'OpenDNS Home', primary: '208.67.222.222', secondary: '208.67.220.220', provider: 'OpenDNS' },
                            { name: 'AdGuard Default', primary: '94.140.14.14', secondary: '94.140.15.15', provider: 'AdGuard' },
                            { name: 'CleanBrowsing', primary: '185.228.168.9', secondary: '185.228.169.9', provider: 'CleanBrowsing' },
                            { name: 'Alternate DNS', primary: '76.76.19.19', secondary: '76.223.100.101', provider: 'Alternate DNS' },
                            { name: 'Yandex DNS', primary: '77.88.8.8', secondary: '77.88.8.1', provider: 'Yandex' }
                        ]
                    },
                    ipv6: {
                        gaming: [
                            { name: 'Cloudflare IPv6', primary: '2606:4700:4700::1111', secondary: '2606:4700:4700::1001', provider: 'Cloudflare' },
                            { name: 'Google IPv6', primary: '2001:4860:4860::8888', secondary: '2001:4860:4860::8844', provider: 'Google' }
                        ],
                        download: [
                            { name: 'Cloudflare IPv6', primary: '2606:4700:4700::1111', secondary: '2606:4700:4700::1001', provider: 'Cloudflare' },
                            { name: 'Google IPv6', primary: '2001:4860:4860::8888', secondary: '2001:4860:4860::8844', provider: 'Google' }
                        ],
                        streaming: [
                            { name: 'Google IPv6', primary: '2001:4860:4860::8888', secondary: '2001:4860:4860::8844', provider: 'Google' },
                            { name: 'Cloudflare IPv6', primary: '2606:4700:4700::1111', secondary: '2606:4700:4700::1001', provider: 'Cloudflare' }
                        ],
                        general: [
                            { name: 'Cloudflare IPv6', primary: '2606:4700:4700::1111', secondary: '2606:4700:4700::1001', provider: 'Cloudflare' },
                            { name: 'Google IPv6', primary: '2001:4860:4860::8888', secondary: '2001:4860:4860::8844', provider: 'Google' },
                            { name: 'Quad9 IPv6', primary: '2620:fe::fe', secondary: '2620:fe::9', provider: 'Quad9' },
                            { name: 'OpenDNS IPv6', primary: '2620:119:35::35', secondary: '2620:119:53::53', provider: 'OpenDNS' }
                        ]
                    }
                };
                
                const selectedServers = globalServers[ipType][usageType] || globalServers[ipType].general;
                const servers = selectedServers.slice(0, count).map((server, index) => ({
                    ...server,
                    ping: Math.floor(Math.random() * 80) + 10,
                    speed: Math.floor(Math.random() * 100) + 30,
                    reliability: Math.floor(Math.random() * 15) + 85,
                    type: usageType,
                    index: index + 1
                }));
                
                displayGlobalDNSResults(servers, usageType);
                userData.totalTests++;
                updateStatistics();
                saveUserData();
            }, 2000);
        }

        function displayGlobalDNSResults(servers, usageType) {
            const resultsDiv = document.getElementById('dnsResults');
            
            const usageTypeNames = {
                gaming: 'گیمینگ',
                download: 'دانلود',
                streaming: 'استریمینگ',
                general: 'عمومی'
            };
            
            let html = `
                <div class="card p-8 rounded-2xl animate-fade-in-up">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold">🌍 بهترین DNS های جهانی برای ${usageTypeNames[usageType]}</h3>
                        <p class="text-sm opacity-75 mt-2">بهینه‌سازی شده برای کاربری ${usageTypeNames[usageType]} در ایران</p>
                    </div>
                    <div class="space-y-6">
            `;
            
            servers.forEach((server, index) => {
                const pingClass = server.ping < 30 ? 'text-green-500' : server.ping < 60 ? 'text-yellow-500' : 'text-red-500';
                const speedClass = server.speed > 70 ? 'text-green-500' : server.speed > 40 ? 'text-yellow-500' : 'text-red-500';
                const reliabilityClass = server.reliability > 90 ? 'text-green-500' : server.reliability > 80 ? 'text-yellow-500' : 'text-red-500';
                
                html += `
                    <div class="dns-item card p-6 rounded-xl border-2 border-transparent hover:border-blue-500 transition-all">
                        <div class="flex justify-between items-center mb-4">
                            <div class="flex items-center space-x-3 space-x-reverse">
                                <div class="w-12 h-12 rounded-full gradient-bg flex items-center justify-center text-white text-xl font-bold">
                                    ${index + 1}
                                </div>
                                <div>
                                    <h4 class="text-xl font-bold">${server.name}</h4>
                                    <p class="text-sm opacity-75">${server.provider}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="flex items-center space-x-2 space-x-reverse mb-1">
                                    <span class="w-3 h-3 rounded-full ${server.ping < 30 ? 'bg-green-500' : server.ping < 60 ? 'bg-yellow-500' : 'bg-red-500'}"></span>
                                    <span class="${pingClass} font-bold">${server.ping}ms</span>
                                </div>
                                <div class="text-xs opacity-75">پینگ</div>
                            </div>
                        </div>
                        
                        <!-- Performance Metrics -->
                        <div class="grid grid-cols-3 gap-4 mb-4">
                            <div class="text-center p-3 rounded-lg" style="background: var(--bg-tertiary);">
                                <div class="${speedClass} font-bold text-lg">${server.speed}</div>
                                <div class="text-xs opacity-75">سرعت (Mbps)</div>
                            </div>
                            <div class="text-center p-3 rounded-lg" style="background: var(--bg-tertiary);">
                                <div class="${pingClass} font-bold text-lg">${server.ping}</div>
                                <div class="text-xs opacity-75">پینگ (ms)</div>
                            </div>
                            <div class="text-center p-3 rounded-lg" style="background: var(--bg-tertiary);">
                                <div class="${reliabilityClass} font-bold text-lg">${server.reliability}%</div>
                                <div class="text-xs opacity-75">قابلیت اطمینان</div>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="text-sm opacity-75 block mb-2">🔹 DNS اولیه:</label>
                                <div class="font-mono p-3 rounded-lg border-2 font-bold" style="background: var(--bg-tertiary); border-color: var(--accent); color: var(--text-primary);">
                                    ${server.primary}
                                </div>
                            </div>
                            <div>
                                <label class="text-sm opacity-75 block mb-2">🔸 DNS ثانویه:</label>
                                <div class="font-mono p-3 rounded-lg border-2 font-bold" style="background: var(--bg-tertiary); border-color: var(--accent); color: var(--text-primary);">
                                    ${server.secondary}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Features -->
                        <div class="mb-4 p-3 rounded-lg" style="background: var(--bg-tertiary);">
                            <h5 class="font-bold mb-2 text-sm">✨ ویژگی‌ها:</h5>
                            <div class="flex flex-wrap gap-2">
                                ${getServerFeatures(server.provider, usageType).map(feature => 
                                    `<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">${feature}</span>`
                                ).join('')}
                            </div>
                        </div>
                        
                        <div class="flex space-x-4 space-x-reverse">
                            <button onclick="copyDNS('${server.primary}', '${server.secondary}')" 
                                    class="btn-primary px-6 py-3 rounded-lg flex-1">
                                📋 کپی DNS
                            </button>
                            <button onclick="saveDNS('${server.primary}', '${server.secondary}', '${server.name}')" 
                                    class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg flex-1 transition-all">
                                💾 ذخیره
                            </button>
                            <button onclick="testDNS('${server.primary}')" 
                                    class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg flex-1 transition-all">
                                🧪 تست DNS
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                    
                    <!-- Usage Tips -->
                    <div class="mt-8 p-6 rounded-xl" style="background: var(--bg-tertiary);">
                        <h4 class="text-lg font-bold mb-4">💡 نکات استفاده برای ${usageTypeNames[usageType]}:</h4>
                        <div class="grid md:grid-cols-2 gap-4 text-sm opacity-75">
                            ${getUsageTips(usageType).map(tip => `<div>• ${tip}</div>`).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }

        function getServerFeatures(provider, usageType) {
            const features = {
                'Cloudflare': ['سرعت بالا', 'حریم خصوصی', 'DoH/DoT', 'جهانی'],
                'Google': ['پایدار', 'سریع', 'قابل اعتماد', 'پشتیبانی IPv6'],
                'Quad9': ['امنیت بالا', 'فیلتر مالور', 'حریم خصوصی', 'DNSSEC'],
                'OpenDNS': ['کنترل والدین', 'فیلتر محتوا', 'آمار کاربری', 'سفارشی‌سازی'],
                'AdGuard': ['مسدود تبلیغات', 'ضد مالور', 'حریم خصوصی', 'فیلتر خانواده'],
                'Yandex': ['سریع در روسیه', 'فیلتر محتوا', 'امن', 'محلی'],
                'CleanBrowsing': ['فیلتر خانواده', 'امن برای کودکان', 'مسدود محتوای بد', 'رایگان'],
                'Alternate DNS': ['بدون لاگ', 'سریع', 'قابل اعتماد', 'ساده']
            };
            
            return features[provider] || ['DNS معتبر', 'قابل اعتماد'];
        }

        function getUsageTips(usageType) {
            const tips = {
                gaming: [
                    'DNS با پینگ کمتر از 30ms انتخاب کنید',
                    'از اتصال کابلی به جای Wi-Fi استفاده کنید',
                    'QoS روتر را برای گیمینگ تنظیم کنید',
                    'پورت‌های مورد نیاز بازی را باز کنید',
                    'تست مداوم پینگ انجام دهید',
                    'از DNS ثانویه حتماً استفاده کنید'
                ],
                download: [
                    'DNS های سریع مثل Cloudflare را ترجیح دهید',
                    'چندین DNS همزمان تست کنید',
                    'از مدیر دانلود با قابلیت تقسیم فایل استفاده کنید',
                    'ساعات کم ترافیک را انتخاب کنید',
                    'کش DNS را مرتب پاک کنید',
                    'پهنای باند ISP را بررسی کنید'
                ],
                streaming: [
                    'Google DNS برای YouTube بهتر است',
                    'کیفیت ویدیو را بر اساس سرعت تنظیم کنید',
                    'از CDN های محلی استفاده کنید',
                    'Buffer کافی برای پخش روان تنظیم کنید',
                    'ترافیک شبکه را کنترل کنید',
                    'DNS cache را برای سایت‌های استریمینگ بهینه کنید'
                ],
                general: [
                    'ترکیبی از DNS های مختلف استفاده کنید',
                    'امنیت را در اولویت قرار دهید',
                    'تست مداوم سرعت انجام دهید',
                    'از DNS های محلی در صورت امکان استفاده کنید',
                    'تنظیمات را بر اساس نیاز تغییر دهید',
                    'از تعویض خودکار DNS استفاده کنید'
                ]
            };
            
            return tips[usageType] || tips.general;
        }

        function displayDNSResults(servers, source) {
            const resultsDiv = document.getElementById('dnsResults');
            
            let html = `
                <div class="card p-8 rounded-2xl animate-fade-in-up">
                    <h3 class="text-2xl font-bold mb-6">🎯 DNS های ${source}</h3>
                    <div class="space-y-6">
            `;
            
            servers.forEach((server, index) => {
                const pingClass = server.ping < 30 ? 'text-green-500' : server.ping < 60 ? 'text-yellow-500' : 'text-red-500';
                html += `
                    <div class="dns-item card p-6 rounded-xl">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-xl font-bold">DNS ${index + 1}</h4>
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <span class="w-3 h-3 rounded-full ${server.ping < 30 ? 'bg-green-500' : server.ping < 60 ? 'bg-yellow-500' : 'bg-red-500'}"></span>
                                <span class="${pingClass} font-bold">${server.ping}ms</span>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="text-sm opacity-75 block mb-2">DNS اولیه:</label>
                                <div class="font-mono p-3 rounded-lg border-2 font-bold" style="background: var(--bg-tertiary); border-color: var(--accent); color: var(--text-primary);">
                                    ${server.primary}
                                </div>
                            </div>
                            <div>
                                <label class="text-sm opacity-75 block mb-2">DNS ثانویه:</label>
                                <div class="font-mono p-3 rounded-lg border-2 font-bold" style="background: var(--bg-tertiary); border-color: var(--accent); color: var(--text-primary);">
                                    ${server.secondary}
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex space-x-4 space-x-reverse">
                            <button onclick="copyDNS('${server.primary}', '${server.secondary}')" 
                                    class="btn-primary px-6 py-3 rounded-lg flex-1">
                                📋 کپی DNS
                            </button>
                            <button onclick="saveDNS('${server.primary}', '${server.secondary}', 'DNS ${index + 1}')" 
                                    class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg flex-1 transition-all">
                                💾 ذخیره
                            </button>
                            <button onclick="testDNS('${server.primary}')" 
                                    class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg flex-1 transition-all">
                                🧪 تست DNS
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div></div>';
            resultsDiv.innerHTML = html;
        }

        function copyDNS(primary, secondary) {
            const text = `DNS اولیه: ${primary}\nDNS ثانویه: ${secondary}`;
            navigator.clipboard.writeText(text).then(() => {
                showNotification('DNS ها کپی شدند! 📋', 'success');
            });
        }

        function saveDNS(primary, secondary, name) {
            const dnsEntry = {
                name: name,
                primary: primary,
                secondary: secondary,
                date: new Date().toLocaleDateString('fa-IR')
            };
            
            userData.savedDNS.push(dnsEntry);
            updateStatistics();
            saveUserData();
            showNotification(`DNS "${name}" ذخیره شد! 💾`, 'success');
        }

        function testDNS(dns) {
            showNotification(`در حال تست DNS ${dns}... نتیجه: عملکرد عالی! ✅`, 'success');
        }

        // Speed Test Functions
        function startSpeedTest() {
            const btn = document.getElementById('speedTestBtn');
            const needle = document.getElementById('speedNeedle');
            const result = document.getElementById('speedResult');
            const downloadSpeedEl = document.getElementById('downloadSpeed');
            const uploadSpeedEl = document.getElementById('uploadSpeed');
            const pingSpeedEl = document.getElementById('pingSpeed');
            
            btn.disabled = true;
            btn.textContent = '⏳ در حال تست...';
            
            let speed = 0;
            const maxSpeed = Math.floor(Math.random() * 100) + 20;
            const downloadSpeed = maxSpeed;
            const uploadSpeed = Math.floor(maxSpeed * 0.7);
            const pingSpeed = Math.floor(Math.random() * 50) + 10;
            
            const interval = setInterval(() => {
                speed += Math.random() * 10;
                if (speed > maxSpeed) speed = maxSpeed;
                
                const rotation = (speed / 120) * 180;
                needle.style.transform = `translate(-50%, -100%) rotate(${rotation}deg)`;
                result.textContent = `${Math.floor(speed)} Mbps`;
                
                if (speed >= maxSpeed) {
                    clearInterval(interval);
                    currentSpeed = maxSpeed;
                    
                    downloadSpeedEl.textContent = `${downloadSpeed} Mbps`;
                    uploadSpeedEl.textContent = `${uploadSpeed} Mbps`;
                    pingSpeedEl.textContent = `${pingSpeed} ms`;
                    
                    // Update user data
                    if (maxSpeed > userData.bestSpeed) {
                        userData.bestSpeed = maxSpeed;
                    }
                    if (pingSpeed < userData.bestPing) {
                        userData.bestPing = pingSpeed;
                    }
                    
                    userData.testHistory.push({
                        date: new Date().toLocaleDateString('fa-IR'),
                        speed: maxSpeed,
                        ping: pingSpeed
                    });
                    
                    userData.totalTests++;
                    updateStatistics();
                    saveUserData();
                    updateSpeedHistory();
                    
                    btn.disabled = false;
                    btn.textContent = '🚀 شروع تست';
                    
                    showNotification(`تست سرعت تکمیل شد! سرعت: ${maxSpeed} Mbps`, 'success');
                }
            }, 100);
        }

        function updateSpeedHistory() {
            const historyDiv = document.getElementById('speedHistory');
            if (userData.testHistory.length === 0) {
                historyDiv.innerHTML = `
                    <div class="text-center opacity-75 py-8">
                        <div class="text-4xl mb-4">📈</div>
                        <p>هنوز تستی انجام نشده است</p>
                    </div>
                `;
                return;
            }

            historyDiv.innerHTML = userData.testHistory.slice(-5).reverse().map((test, index) => `
                <div class="flex justify-between items-center p-4 rounded-lg" style="background: var(--bg-tertiary);">
                    <div>
                        <div class="font-bold">${test.speed} Mbps</div>
                        <div class="text-sm opacity-75">${test.date}</div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold ${test.ping < 30 ? 'text-green-500' : test.ping < 60 ? 'text-yellow-500' : 'text-red-500'}">${test.ping} ms</div>
                        <div class="text-sm opacity-75">پینگ</div>
                    </div>
                </div>
            `).join('');
        }

        // Tools Functions
        function performDNSLookup() {
            const domain = document.getElementById('lookupDomain').value;
            if (!domain) {
                showNotification('لطفاً نام دامنه را وارد کنید', 'warning');
                return;
            }

            const resultsDiv = document.getElementById('lookupResults');
            const contentDiv = document.getElementById('lookupContent');
            
            resultsDiv.style.display = 'block';
            contentDiv.innerHTML = '<div class="loading-spinner"></div>';
            
            setTimeout(() => {
                const mockResults = [
                    { type: 'A', value: '104.21.14.101' },
                    { type: 'A', value: '172.67.74.226' },
                    { type: 'AAAA', value: '2606:4700:20::681a:e65' },
                    { type: 'MX', value: 'mail.example.com' },
                    { type: 'NS', value: 'ns1.example.com' }
                ];
                
                contentDiv.innerHTML = mockResults.map(record => `
                    <div class="flex justify-between items-center py-2 border-b border-gray-200">
                        <span class="font-bold">${record.type}</span>
                        <span class="font-mono">${record.value}</span>
                    </div>
                `).join('');
            }, 1500);
        }

        function flushDNSCache() {
            showNotification('کش DNS پاک شد! (شبیه‌سازی)', 'success');
        }

        function runNetworkDiagnostics() {
            const resultsDiv = document.getElementById('diagnosticsResults');
            resultsDiv.innerHTML = '<div class="loading-spinner"></div>';
            
            setTimeout(() => {
                const diagnostics = [
                    { test: 'اتصال اینترنت', status: 'موفق', icon: '✅' },
                    { test: 'DNS Resolution', status: 'موفق', icon: '✅' },
                    { test: 'سرعت اتصال', status: 'خوب', icon: '⚡' },
                    { test: 'امنیت اتصال', status: 'امن', icon: '🔒' }
                ];
                
                resultsDiv.innerHTML = diagnostics.map(diag => `
                    <div class="flex justify-between items-center p-3 rounded-lg" style="background: var(--bg-tertiary);">
                        <span>${diag.icon} ${diag.test}</span>
                        <span class="font-bold text-green-500">${diag.status}</span>
                    </div>
                `).join('');
            }, 2000);
        }

        function checkDNSSecurity() {
            const resultsDiv = document.getElementById('securityResults');
            resultsDiv.innerHTML = '<div class="loading-spinner"></div>';
            
            setTimeout(() => {
                const securityChecks = [
                    { check: 'DNS over HTTPS', status: 'فعال', icon: '🔒' },
                    { check: 'DNS Filtering', status: 'فعال', icon: '🛡️' },
                    { check: 'Malware Protection', status: 'فعال', icon: '🦠' },
                    { check: 'Privacy Protection', status: 'فعال', icon: '👁️' }
                ];
                
                resultsDiv.innerHTML = securityChecks.map(check => `
                    <div class="flex justify-between items-center p-3 rounded-lg" style="background: var(--bg-tertiary);">
                        <span>${check.icon} ${check.check}</span>
                        <span class="font-bold text-green-500">${check.status}</span>
                    </div>
                `).join('');
            }, 1500);
        }

        // Ping Functions
        function startPingTest() {
            const server = document.getElementById('pingDNSServer').value;
            const count = document.getElementById('pingCount').value;
            const customDNS = document.getElementById('customDNS').value;
            
            const targetDNS = server === 'custom' ? customDNS : server;
            
            if (!targetDNS) {
                showNotification('لطفاً DNS سرور را انتخاب کنید', 'warning');
                return;
            }
            
            const btn = document.getElementById('pingTestBtn');
            btn.disabled = true;
            btn.textContent = '⏳ در حال تست...';
            
            const resultsDiv = document.getElementById('pingResults');
            resultsDiv.classList.remove('hidden');
            
            setTimeout(() => {
                const pingData = [];
                const testCount = count === 'continuous' ? 20 : parseInt(count);
                
                for (let i = 0; i < testCount; i++) {
                    pingData.push({
                        sequence: i + 1,
                        time: Math.floor(Math.random() * 100) + 10,
                        status: 'success'
                    });
                }
                
                displayPingResults(pingData, targetDNS);
                
                btn.disabled = false;
                btn.textContent = '📊 شروع تست پینگ';
            }, 3000);
        }

        function displayPingResults(data, server) {
            const chartDiv = document.getElementById('pingChart');
            const statsDiv = document.getElementById('pingStats');
            
            // Calculate statistics
            const times = data.map(d => d.time);
            const avgPing = Math.round(times.reduce((a, b) => a + b, 0) / times.length);
            const minPing = Math.min(...times);
            const maxPing = Math.max(...times);
            const lostPackets = data.filter(d => d.status !== 'success').length;
            
            // Display statistics
            statsDiv.innerHTML = `
                <div class="text-center p-4 rounded-lg" style="background: var(--bg-tertiary);">
                    <div class="text-2xl font-bold text-blue-500">${avgPing}ms</div>
                    <div class="text-sm opacity-75">میانگین</div>
                </div>
                <div class="text-center p-4 rounded-lg" style="background: var(--bg-tertiary);">
                    <div class="text-2xl font-bold text-green-500">${minPing}ms</div>
                    <div class="text-sm opacity-75">کمترین</div>
                </div>
                <div class="text-center p-4 rounded-lg" style="background: var(--bg-tertiary);">
                    <div class="text-2xl font-bold text-red-500">${maxPing}ms</div>
                    <div class="text-sm opacity-75">بیشترین</div>
                </div>
                <div class="text-center p-4 rounded-lg" style="background: var(--bg-tertiary);">
                    <div class="text-2xl font-bold text-orange-500">${lostPackets}</div>
                    <div class="text-sm opacity-75">بسته گم شده</div>
                </div>
            `;
            
            // Simple chart representation
            chartDiv.innerHTML = `
                <div class="text-center mb-4">
                    <h4 class="text-lg font-bold">نمودار پینگ ${server}</h4>
                </div>
                <div class="flex items-end justify-center space-x-1 h-48">
                    ${data.slice(0, 20).map(d => `
                        <div class="bg-blue-500 rounded-t" style="width: 12px; height: ${(d.time / maxPing) * 180}px;" title="${d.time}ms"></div>
                    `).join('')}
                </div>
            `;
        }

        // Compare Functions
        function compareDNS() {
            const dns1 = document.getElementById('dns1').value;
            const dns2 = document.getElementById('dns2').value;
            
            if (!dns1 || !dns2) {
                showNotification('لطفاً هر دو DNS را وارد کنید', 'warning');
                return;
            }
            
            const resultsDiv = document.getElementById('comparisonResults');
            resultsDiv.classList.remove('hidden');
            
            setTimeout(() => {
                const comparison = {
                    dns1: {
                        address: dns1,
                        ping: Math.floor(Math.random() * 50) + 10,
                        speed: Math.floor(Math.random() * 100) + 20,
                        reliability: Math.floor(Math.random() * 20) + 80,
                        security: Math.floor(Math.random() * 20) + 80
                    },
                    dns2: {
                        address: dns2,
                        ping: Math.floor(Math.random() * 50) + 10,
                        speed: Math.floor(Math.random() * 100) + 20,
                        reliability: Math.floor(Math.random() * 20) + 80,
                        security: Math.floor(Math.random() * 20) + 80
                    }
                };
                
                displayComparisonResults(comparison);
            }, 2000);
        }

        function displayComparisonResults(data) {
            const tableDiv = document.getElementById('comparisonTable');
            
            tableDiv.innerHTML = `
                <table class="w-full">
                    <thead>
                        <tr class="border-b">
                            <th class="text-right p-4">معیار</th>
                            <th class="text-center p-4">${data.dns1.address}</th>
                            <th class="text-center p-4">${data.dns2.address}</th>
                            <th class="text-center p-4">برنده</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b">
                            <td class="p-4 font-bold">پینگ</td>
                            <td class="text-center p-4">${data.dns1.ping}ms</td>
                            <td class="text-center p-4">${data.dns2.ping}ms</td>
                            <td class="text-center p-4">${data.dns1.ping < data.dns2.ping ? '🥇 DNS 1' : '🥇 DNS 2'}</td>
                        </tr>
                        <tr class="border-b">
                            <td class="p-4 font-bold">سرعت</td>
                            <td class="text-center p-4">${data.dns1.speed} Mbps</td>
                            <td class="text-center p-4">${data.dns2.speed} Mbps</td>
                            <td class="text-center p-4">${data.dns1.speed > data.dns2.speed ? '🥇 DNS 1' : '🥇 DNS 2'}</td>
                        </tr>
                        <tr class="border-b">
                            <td class="p-4 font-bold">قابلیت اطمینان</td>
                            <td class="text-center p-4">${data.dns1.reliability}%</td>
                            <td class="text-center p-4">${data.dns2.reliability}%</td>
                            <td class="text-center p-4">${data.dns1.reliability > data.dns2.reliability ? '🥇 DNS 1' : '🥇 DNS 2'}</td>
                        </tr>
                        <tr>
                            <td class="p-4 font-bold">امنیت</td>
                            <td class="text-center p-4">${data.dns1.security}%</td>
                            <td class="text-center p-4">${data.dns2.security}%</td>
                            <td class="text-center p-4">${data.dns1.security > data.dns2.security ? '🥇 DNS 1' : '🥇 DNS 2'}</td>
                        </tr>
                    </tbody>
                </table>
            `;
        }

        // Education Functions
        function showEducationTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            const contentDiv = document.getElementById('educationContent');
            
            const content = {
                basics: `
                    <div class="space-y-6">
                        <h3 class="text-2xl font-bold">🎯 DNS چیست؟</h3>
                        <p class="text-lg opacity-75">DNS یا Domain Name System سیستمی است که نام‌های دامنه را به آدرس‌های IP تبدیل می‌کند.</p>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="p-6 rounded-lg" style="background: var(--bg-tertiary);">
                                <h4 class="text-xl font-bold mb-4">🔍 نحوه کارکرد</h4>
                                <ul class="space-y-2 opacity-75">
                                    <li>1. شما آدرس وب‌سایت را تایپ می‌کنید</li>
                                    <li>2. مرورگر از DNS سرور می‌پرسد</li>
                                    <li>3. DNS آدرس IP را برمی‌گرداند</li>
                                    <li>4. مرورگر به آن IP متصل می‌شود</li>
                                </ul>
                            </div>
                            
                            <div class="p-6 rounded-lg" style="background: var(--bg-tertiary);">
                                <h4 class="text-xl font-bold mb-4">⚡ مزایای DNS سریع</h4>
                                <ul class="space-y-2 opacity-75">
                                    <li>• بارگذاری سریع‌تر صفحات</li>
                                    <li>• کاهش زمان پاسخ</li>
                                    <li>• تجربه بهتر کاربری</li>
                                    <li>• دسترسی بهتر به محتوا</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `,
                setup: `
                    <div class="space-y-6">
                        <h3 class="text-2xl font-bold">⚙️ نحوه تنظیم DNS</h3>
                        
                        <div class="space-y-8">
                            <div class="p-6 rounded-lg" style="background: var(--bg-tertiary);">
                                <h4 class="text-xl font-bold mb-4">🖥️ ویندوز</h4>
                                <ol class="space-y-2 opacity-75">
                                    <li>1. به Control Panel > Network and Internet بروید</li>
                                    <li>2. روی Change adapter settings کلیک کنید</li>
                                    <li>3. روی اتصال شبکه راست کلیک کرده و Properties را انتخاب کنید</li>
                                    <li>4. Internet Protocol Version 4 را انتخاب کنید</li>
                                    <li>5. Use the following DNS server addresses را انتخاب کنید</li>
                                    <li>6. آدرس‌های DNS را وارد کنید</li>
                                </ol>
                            </div>
                            
                            <div class="p-6 rounded-lg" style="background: var(--bg-tertiary);">
                                <h4 class="text-xl font-bold mb-4">🍎 macOS</h4>
                                <ol class="space-y-2 opacity-75">
                                    <li>1. به System Preferences > Network بروید</li>
                                    <li>2. اتصال شبکه را انتخاب کنید</li>
                                    <li>3. روی Advanced کلیک کنید</li>
                                    <li>4. تب DNS را انتخاب کنید</li>
                                    <li>5. آدرس‌های DNS را اضافه کنید</li>
                                </ol>
                            </div>
                            
                            <div class="p-6 rounded-lg" style="background: var(--bg-tertiary);">
                                <h4 class="text-xl font-bold mb-4">📱 موبایل (Android/iOS)</h4>
                                <ol class="space-y-2 opacity-75">
                                    <li>1. به تنظیمات Wi-Fi بروید</li>
                                    <li>2. روی شبکه متصل کلیک کنید</li>
                                    <li>3. تنظیمات پیشرفته را انتخاب کنید</li>
                                    <li>4. DNS را به Manual تغییر دهید</li>
                                    <li>5. آدرس‌های DNS را وارد کنید</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                `,
                troubleshooting: `
                    <div class="space-y-6">
                        <h3 class="text-2xl font-bold">🔧 عیب‌یابی DNS</h3>
                        
                        <div class="space-y-6">
                            <div class="p-6 rounded-lg" style="background: var(--bg-tertiary);">
                                <h4 class="text-xl font-bold mb-4">❌ مشکلات رایج</h4>
                                <ul class="space-y-3 opacity-75">
                                    <li><strong>سایت باز نمی‌شود:</strong> DNS Cache را پاک کنید</li>
                                    <li><strong>اینترنت کند است:</strong> DNS سریع‌تری انتخاب کنید</li>
                                    <li><strong>برخی سایت‌ها فیلتر هستند:</strong> از DNS های آزاد استفاده کنید</li>
                                    <li><strong>قطعی مکرر:</strong> DNS ثانویه تنظیم کنید</li>
                                </ul>
                            </div>
                            
                            <div class="p-6 rounded-lg" style="background: var(--bg-tertiary);">
                                <h4 class="text-xl font-bold mb-4">🛠️ راه‌حل‌ها</h4>
                                <ul class="space-y-3 opacity-75">
                                    <li><strong>Flush DNS Cache:</strong> ipconfig /flushdns (Windows)</li>
                                    <li><strong>تست DNS:</strong> nslookup google.com</li>
                                    <li><strong>تغییر DNS:</strong> از DNS های معتبر استفاده کنید</li>
                                    <li><strong>ریست شبکه:</strong> تنظیمات شبکه را بازنشانی کنید</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `,
                security: `
                    <div class="space-y-6">
                        <h3 class="text-2xl font-bold">🔒 امنیت DNS</h3>
                        
                        <div class="space-y-6">
                            <div class="p-6 rounded-lg" style="background: var(--bg-tertiary);">
                                <h4 class="text-xl font-bold mb-4">⚠️ تهدیدات امنیتی</h4>
                                <ul class="space-y-3 opacity-75">
                                    <li><strong>DNS Hijacking:</strong> هدایت به سایت‌های مخرب</li>
                                    <li><strong>DNS Spoofing:</strong> جعل پاسخ‌های DNS</li>
                                    <li><strong>Man-in-the-Middle:</strong> رهگیری ترافیک</li>
                                    <li><strong>DNS Tunneling:</strong> انتقال داده‌های مخرب</li>
                                </ul>
                            </div>
                            
                            <div class="p-6 rounded-lg" style="background: var(--bg-tertiary);">
                                <h4 class="text-xl font-bold mb-4">🛡️ راه‌های محافظت</h4>
                                <ul class="space-y-3 opacity-75">
                                    <li><strong>DNS over HTTPS (DoH):</strong> رمزگذاری ترافیک DNS</li>
                                    <li><strong>DNS over TLS (DoT):</strong> امنیت لایه انتقال</li>
                                    <li><strong>DNSSEC:</strong> تأیید اصالت پاسخ‌ها</li>
                                    <li><strong>Secure DNS Providers:</strong> استفاده از ارائه‌دهندگان امن</li>
                                </ul>
                            </div>
                            
                            <div class="p-6 rounded-lg" style="background: var(--bg-tertiary);">
                                <h4 class="text-xl font-bold mb-4">✅ DNS های امن پیشنهادی</h4>
                                <ul class="space-y-3 opacity-75">
                                    <li><strong>Cloudflare:</strong> 1.1.1.1 / 1.0.0.1</li>
                                    <li><strong>Quad9:</strong> 9.9.9.9 / 149.112.112.112</li>
                                    <li><strong>OpenDNS:</strong> 208.67.222.222 / 208.67.220.220</li>
                                    <li><strong>AdGuard:</strong> 94.140.14.14 / 94.140.15.15</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `
            };
            
            contentDiv.innerHTML = content[tabName];
        }

        // Profile Functions
        function saveUserPreferences() {
            userData.preferences = {
                autoTheme: document.getElementById('autoTheme').checked,
                animations: document.getElementById('animations').checked,
                testNotifications: document.getElementById('testNotifications').checked,
                smartSuggestions: document.getElementById('smartSuggestions').checked
            };
            
            saveUserData();
            showNotification('تنظیمات ذخیره شد! 💾', 'success');
        }

        // AI Functions
        function startAIOptimization() {
            const usageType = document.getElementById('aiUsageType').value;
            const resultsDiv = document.getElementById('aiResults');
            const contentDiv = document.getElementById('aiContent');
            
            resultsDiv.classList.remove('hidden');
            contentDiv.innerHTML = '<div class="loading-spinner"></div>';
            
            setTimeout(() => {
                const recommendations = {
                    gaming: {
                        primary: '1.1.1.1',
                        secondary: '1.0.0.1',
                        reason: 'کمترین تأخیر برای گیمینگ',
                        tips: ['استفاده از Ethernet به جای Wi-Fi', 'بستن برنامه‌های اضافی', 'تنظیم QoS روتر']
                    },
                    streaming: {
                        primary: '8.8.8.8',
                        secondary: '8.8.4.4',
                        reason: 'بهترین عملکرد برای استریمینگ',
                        tips: ['استفاده از CDN های محلی', 'تنظیم کیفیت ویدیو', 'بررسی پهنای باند']
                    },
                    work: {
                        primary: '9.9.9.9',
                        secondary: '149.112.112.112',
                        reason: 'امنیت و قابلیت اطمینان بالا',
                        tips: ['استفاده از VPN شرکتی', 'فعال‌سازی فایروال', 'بررسی مداوم امنیت']
                    },
                    general: {
                        primary: '1.1.1.1',
                        secondary: '8.8.8.8',
                        reason: 'تعادل بین سرعت و امنیت',
                        tips: ['تست مداوم سرعت', 'استفاده از DNS ثانویه', 'بروزرسانی تنظیمات']
                    }
                };
                
                const rec = recommendations[usageType];
                contentDiv.innerHTML = `
                    <div class="space-y-4">
                        <h4 class="text-lg font-bold">🎯 پیشنهاد هوش مصنوعی:</h4>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="p-4 rounded-lg" style="background: var(--bg-primary);">
                                <label class="text-sm opacity-75">DNS اولیه:</label>
                                <div class="font-mono font-bold text-lg">${rec.primary}</div>
                            </div>
                            <div class="p-4 rounded-lg" style="background: var(--bg-primary);">
                                <label class="text-sm opacity-75">DNS ثانویه:</label>
                                <div class="font-mono font-bold text-lg">${rec.secondary}</div>
                            </div>
                        </div>
                        <div class="p-4 rounded-lg" style="background: var(--bg-primary);">
                            <h5 class="font-bold mb-2">💡 دلیل انتخاب:</h5>
                            <p class="opacity-75">${rec.reason}</p>
                        </div>
                        <div class="p-4 rounded-lg" style="background: var(--bg-primary);">
                            <h5 class="font-bold mb-2">📋 نکات بهینه‌سازی:</h5>
                            <ul class="space-y-1 opacity-75">
                                ${rec.tips.map(tip => `<li>• ${tip}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="flex space-x-4 space-x-reverse">
                            <button onclick="copyDNS('${rec.primary}', '${rec.secondary}')" class="btn-primary px-6 py-3 rounded-lg flex-1">
                                📋 کپی DNS
                            </button>
                            <button onclick="saveDNS('${rec.primary}', '${rec.secondary}', 'AI Optimized')" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg flex-1 transition-all">
                                💾 ذخیره
                            </button>
                        </div>
                    </div>
                `;
            }, 3000);
        }

        // Auto DNS Switcher System
        let autoSwitcherInterval = null;
        let currentOptimalDNS = { primary: '1.1.1.1', secondary: '1.0.0.1', ping: 0 };
        
        function toggleAutoSwitcher() {
            autoSwitcherActive = !autoSwitcherActive;
            const btn = document.getElementById('autoSwitcherBtn');
            const statusText = document.getElementById('autoSwitcherStatusText');
            const statusBadge = document.getElementById('autoSwitcherStatus');
            
            if (autoSwitcherActive) {
                btn.textContent = '⏸️ توقف تعویض خودکار';
                statusText.textContent = 'فعال';
                statusText.className = 'font-bold text-green-500';
                statusBadge.className = 'switcher-status switcher-active';
                statusBadge.innerHTML = '<span class="w-2 h-2 rounded-full bg-current"></span><span>خودکار فعال</span>';
                
                // Start auto switching
                startAutoSwitcher();
                showNotification('تعویض خودکار DNS فعال شد! 🔄', 'success');
            } else {
                btn.textContent = '🔄 فعال‌سازی تعویض خودکار';
                statusText.textContent = 'خاموش';
                statusText.className = 'font-bold text-red-500';
                statusBadge.className = 'switcher-status switcher-inactive';
                statusBadge.innerHTML = '<span class="w-2 h-2 rounded-full bg-current"></span><span>خودکار خاموش</span>';
                
                // Stop auto switching
                stopAutoSwitcher();
                showNotification('تعویض خودکار DNS متوقف شد! ⏸️', 'info');
            }
        }

        function startAutoSwitcher() {
            // Initial scan
            performDNSOptimization();
            
            // Set interval for continuous monitoring (every 30 seconds)
            autoSwitcherInterval = setInterval(() => {
                performDNSOptimization();
            }, 30000);
        }

        function stopAutoSwitcher() {
            if (autoSwitcherInterval) {
                clearInterval(autoSwitcherInterval);
                autoSwitcherInterval = null;
            }
        }

        function performDNSOptimization() {
            const dnsServers = [
                { name: 'Cloudflare', primary: '1.1.1.1', secondary: '1.0.0.1' },
                { name: 'Google', primary: '8.8.8.8', secondary: '8.8.4.4' },
                { name: 'Quad9', primary: '9.9.9.9', secondary: '149.112.112.112' },
                { name: 'OpenDNS', primary: '208.67.222.222', secondary: '208.67.220.220' },
                { name: 'AdGuard', primary: '94.140.14.14', secondary: '94.140.15.15' },
                { name: 'Yandex', primary: '77.88.8.8', secondary: '77.88.8.1' }
            ];

            // Simulate testing each DNS server
            const testResults = dnsServers.map(dns => ({
                ...dns,
                ping: Math.floor(Math.random() * 100) + 10,
                speed: Math.floor(Math.random() * 80) + 20,
                reliability: Math.floor(Math.random() * 20) + 80
            }));

            // Find the best DNS based on ping and speed
            const bestDNS = testResults.reduce((best, current) => {
                const bestScore = (100 - best.ping) + best.speed + best.reliability;
                const currentScore = (100 - current.ping) + current.speed + current.reliability;
                return currentScore > bestScore ? current : best;
            });

            // Check if we need to switch
            if (bestDNS.primary !== currentOptimalDNS.primary || 
                Math.abs(bestDNS.ping - currentOptimalDNS.ping) > 20) {
                
                currentOptimalDNS = bestDNS;
                
                // Notify user about the switch
                showNotification(
                    `🔄 DNS بهینه تغییر کرد!\n` +
                    `جدید: ${bestDNS.name} (${bestDNS.primary})\n` +
                    `پینگ: ${bestDNS.ping}ms | سرعت: ${bestDNS.speed}Mbps`, 
                    'success'
                );

                // Update AI chat with optimization info
                if (document.getElementById('chatMessages')) {
                    const messagesDiv = document.getElementById('chatMessages');
                    messagesDiv.innerHTML += `
                        <div class="flex items-start space-x-3 space-x-reverse">
                            <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white text-sm">🔄</div>
                            <div class="bg-green-100 text-green-900 p-3 rounded-lg max-w-xs">
                                <strong>بهینه‌سازی خودکار:</strong><br>
                                DNS بهینه: ${bestDNS.name}<br>
                                آدرس: ${bestDNS.primary}<br>
                                پینگ: ${bestDNS.ping}ms<br>
                                امتیاز کیفیت: ${Math.floor((100 - bestDNS.ping) + bestDNS.speed + bestDNS.reliability)}/300
                            </div>
                        </div>
                    `;
                    messagesDiv.scrollTop = messagesDiv.scrollHeight;
                }
            }
        }

        // AI Assistant Functions
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const messagesDiv = document.getElementById('chatMessages');
            
            // Add user message
            messagesDiv.innerHTML += `
                <div class="flex items-start space-x-3 space-x-reverse justify-end">
                    <div class="bg-blue-500 text-white p-3 rounded-lg max-w-xs">
                        ${message}
                    </div>
                    <div class="w-8 h-8 rounded-full bg-gray-500 flex items-center justify-center text-white text-sm">👤</div>
                </div>
            `;
            
            input.value = '';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            // Show typing indicator
            messagesDiv.innerHTML += `
                <div class="flex items-start space-x-3 space-x-reverse" id="typingIndicator">
                    <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm">🤖</div>
                    <div class="bg-blue-100 text-blue-900 p-3 rounded-lg">
                        <div class="flex space-x-1">
                            <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce"></div>
                            <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.1s;"></div>
                            <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.2s;"></div>
                        </div>
                    </div>
                </div>
            `;
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            // Process message with AI
            setTimeout(() => {
                document.getElementById('typingIndicator').remove();
                const aiResponse = processAIMessage(message);
                
                messagesDiv.innerHTML += `
                    <div class="flex items-start space-x-3 space-x-reverse">
                        <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm">🤖</div>
                        <div class="bg-blue-100 text-blue-900 p-3 rounded-lg max-w-xs">
                            ${aiResponse}
                        </div>
                    </div>
                `;
                
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }, Math.random() * 2000 + 1000);
        }

        function processAIMessage(message) {
            const lowerMessage = message.toLowerCase();
            
            // DNS Speed Analysis
            if (lowerMessage.includes('سرعت') || lowerMessage.includes('کند') || lowerMessage.includes('آهسته')) {
                const currentSpeed = userData.bestSpeed || 0;
                if (currentSpeed < 20) {
                    return `🔍 تحلیل سرعت شما: ${currentSpeed} Mbps کمتر از حد مطلوب است. پیشنهاد می‌کنم DNS های Cloudflare (1.1.1.1) یا Google (8.8.8.8) را امتحان کنید. همچنین بررسی کنید که آیا ISP شما محدودیت سرعت دارد یا خیر.`;
                } else if (currentSpeed < 50) {
                    return `⚡ سرعت فعلی شما ${currentSpeed} Mbps قابل قبول است اما می‌توان بهبود داد. برای بهینه‌سازی، از DNS های محلی استفاده کنید و کش DNS را پاک کنید.`;
                } else {
                    return `🚀 سرعت ${currentSpeed} Mbps شما عالی است! برای حفظ این عملکرد، تست مداوم انجام دهید و از تعویض خودکار DNS استفاده کنید.`;
                }
            }
            
            // Gaming DNS
            if (lowerMessage.includes('گیم') || lowerMessage.includes('بازی') || lowerMessage.includes('پینگ')) {
                const bestPing = userData.bestPing === Infinity ? 'نامشخص' : userData.bestPing + 'ms';
                return `🎮 برای گیمینگ بهینه، پینگ زیر 30ms ضروری است. پینگ فعلی شما: ${bestPing}. پیشنهادات:\n• Cloudflare: 1.1.1.1 (پینگ کم)\n• Google: 8.8.8.8 (پایدار)\n• از اتصال کابلی استفاده کنید\n• QoS روتر را تنظیم کنید`;
            }
            
            // Filtering Issues
            if (lowerMessage.includes('فیلتر') || lowerMessage.includes('بسته') || lowerMessage.includes('محدود')) {
                return `🔓 برای دور زدن فیلترینگ:\n• DNS آزاد: 8.8.8.8 / 8.8.4.4\n• Cloudflare: 1.1.1.1 / 1.0.0.1\n• OpenDNS: 208.67.222.222\n• DNS over HTTPS فعال کنید\n• از VPN معتبر استفاده کنید\n⚠️ قوانین محلی را رعایت کنید`;
            }
            
            // Security Questions
            if (lowerMessage.includes('امن') || lowerMessage.includes('امنیت') || lowerMessage.includes('خطر')) {
                return `🔒 برای امنیت DNS:\n• از DNS های معتبر استفاده کنید\n• DNSSEC را فعال کنید\n• DNS over HTTPS (DoH) تنظیم کنید\n• مراقب DNS Hijacking باشید\n• تنظیمات را مداوم بررسی کنید\n🛡️ پیشنهاد: Quad9 (9.9.9.9) برای امنیت بالا`;
            }
            
            // Performance Analysis
            if (lowerMessage.includes('بهترین') || lowerMessage.includes('پیشنهاد') || lowerMessage.includes('انتخاب')) {
                const totalTests = userData.totalTests || 0;
                if (totalTests === 0) {
                    return `📊 برای پیشنهاد بهترین DNS، ابتدا چند تست انجام دهید. بر اساس موقعیت جغرافیایی ایران:\n• سرعت: 1.1.1.1\n• امنیت: 9.9.9.9\n• پایداری: 8.8.8.8\n• محلی: 178.22.122.100`;
                } else {
                    return `🎯 بر اساس ${totalTests} تست شما، بهترین DNS ها:\n• سرعت بالا: Cloudflare\n• پینگ کم: Google\n• امنیت: Quad9\n💡 تعویض خودکار را فعال کنید تا همیشه بهترین DNS استفاده شود.`;
                }
            }
            
            // Technical Help
            if (lowerMessage.includes('تنظیم') || lowerMessage.includes('نصب') || lowerMessage.includes('چطور')) {
                return `⚙️ راهنمای تنظیم DNS:\n\n🖥️ ویندوز:\nControl Panel → Network → Change adapter settings → Properties → IPv4 → DNS\n\n📱 موبایل:\nWi-Fi Settings → Advanced → DNS → Manual\n\n🍎 Mac:\nSystem Preferences → Network → Advanced → DNS\n\n💡 نکته: همیشه DNS ثانویه تنظیم کنید`;
            }
            
            // Troubleshooting
            if (lowerMessage.includes('مشکل') || lowerMessage.includes('کار نمی') || lowerMessage.includes('خراب')) {
                return `🔧 عیب‌یابی DNS:\n\n1️⃣ کش DNS را پاک کنید:\n• Windows: ipconfig /flushdns\n• Mac: sudo dscacheutil -flushcache\n\n2️⃣ DNS دیگری امتحان کنید\n3️⃣ اتصال اینترنت را بررسی کنید\n4️⃣ فایروال را موقتاً غیرفعال کنید\n5️⃣ تنظیمات شبکه را ریست کنید`;
            }
            
            // Streaming
            if (lowerMessage.includes('استریم') || lowerMessage.includes('ویدیو') || lowerMessage.includes('یوتیوب')) {
                return `📺 بهینه‌سازی برای استریمینگ:\n• Google DNS: 8.8.8.8 (بهترین برای YouTube)\n• Cloudflare: 1.1.1.1 (سرعت بالا)\n• پهنای باند کافی داشته باشید\n• کیفیت ویدیو را تنظیم کنید\n• از CDN های محلی استفاده کنید`;
            }
            
            // General Questions
            if (lowerMessage.includes('چیست') || lowerMessage.includes('چی هست') || lowerMessage.includes('تعریف')) {
                return `🎓 DNS (Domain Name System):\nسیستمی که نام‌های دامنه (مثل google.com) را به آدرس IP تبدیل می‌کند. مثل دفترچه تلفن اینترنت!\n\n🔄 فرآیند:\n1. شما آدرس تایپ می‌کنید\n2. DNS آدرس IP را پیدا می‌کند\n3. مرورگر به آن IP متصل می‌شود\n4. سایت نمایش داده می‌شود`;
            }
            
            // Auto Switcher Questions
            if (lowerMessage.includes('خودکار') || lowerMessage.includes('تعویض') || lowerMessage.includes('اتوماتیک')) {
                return `🔄 تعویض خودکار DNS:\n\n✅ چه کار می‌کند:\n• هر 30 ثانیه DNS فعلی را تست می‌کند\n• سرعت و پینگ را بررسی می‌کند\n• در صورت کاهش کیفیت، DNS بهتر پیدا می‌کند\n• خودکار تغییر می‌دهد\n\n🎯 مزایا:\n• همیشه بهترین عملکرد\n• عدم قطعی اتصال\n• بهینه‌سازی مداوم`;
            }
            
            // Default intelligent response
            const responses = [
                `🤖 سوال جالبی پرسیدید! بر اساس تحلیل پیام شما، پیشنهاد می‌کنم ابتدا تست سرعت انجام دهید تا بتوانم راهنمایی دقیق‌تری ارائه دهم.`,
                `💡 برای پاسخ بهتر، لطفاً مشکل خاص خود را بیان کنید. آیا مشکل سرعت، فیلترینگ، یا تنظیمات دارید؟`,
                `🔍 در حال تحلیل درخواست شما... آیا می‌خواهید در مورد بهینه‌سازی DNS، امنیت، یا عیب‌یابی بیشتر بدانید؟`,
                `📊 بر اساس آمار کاربران، ${Math.floor(Math.random() * 80 + 20)}% مشکلات DNS با تغییر سرور حل می‌شود. چه مشکل خاصی دارید؟`
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Admin Functions
        function sendGlobalMessage() {
            if (!isAdmin()) {
                showNotification('دسترسی غیرمجاز!', 'error');
                return;
            }

            const messageInput = document.getElementById('globalMessageInput');
            const message = messageInput.value.trim();
            
            if (!message) {
                showNotification('لطفاً پیام را وارد کنید', 'warning');
                return;
            }

            const messageData = {
                content: message,
                date: new Date().toISOString(),
                author: currentUser.name
            };

            localStorage.setItem('globalMessage', JSON.stringify(messageData));
            
            // Show current message in admin panel
            const currentMessageDiv = document.getElementById('currentGlobalMessage');
            const currentContentDiv = document.getElementById('currentMessageContent');
            const currentDateDiv = document.getElementById('currentMessageDate');
            
            currentContentDiv.textContent = message;
            currentDateDiv.textContent = new Date().toLocaleDateString('fa-IR');
            currentMessageDiv.classList.remove('hidden');
            
            // Show banner for all users
            showGlobalMessageBanner(message, messageData.date);
            
            messageInput.value = '';
            showNotification('پیام همگانی ارسال شد! 📢', 'success');
            
            // Add to activities
            addSystemActivity(`پیام همگانی ارسال شد: "${message.substring(0, 30)}..."`);
        }

        function clearGlobalMessage() {
            if (!isAdmin()) {
                showNotification('دسترسی غیرمجاز!', 'error');
                return;
            }

            localStorage.removeItem('globalMessage');
            
            // Hide current message in admin panel
            document.getElementById('currentGlobalMessage').classList.add('hidden');
            
            // Hide banner
            hideGlobalMessageBanner();
            
            showNotification('پیام همگانی حذف شد! 🗑️', 'success');
            addSystemActivity('پیام همگانی حذف شد');
        }

        function refreshUserStats() {
            if (!isAdmin()) {
                showNotification('دسترسی غیرمجاز!', 'error');
                return;
            }

            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const totalUsers = users.length;
            const onlineUsers = currentUser ? 1 : 0; // Simplified online detection
            
            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('onlineUsers').textContent = onlineUsers;
            
            // Load users list
            const usersList = document.getElementById('usersList');
            if (users.length === 0) {
                usersList.innerHTML = '<div class="text-center opacity-75 py-4">هیچ کاربری ثبت نشده</div>';
            } else {
                usersList.innerHTML = users.map((user, index) => `
                    <div class="flex justify-between items-center p-3 rounded-lg" style="background: var(--bg-primary);">
                        <div>
                            <div class="font-bold">${user.name}</div>
                            <div class="text-sm opacity-75">@${user.username}</div>
                            <div class="text-xs opacity-50">عضو از: ${user.joinDate || 'امروز'}</div>
                        </div>
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <span class="text-xs opacity-50">ID: ${user.id || index + 1}</span>
                            <button onclick="deleteSpecificUser(${user.id || index})" 
                                    class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs transition-all">
                                🗑️
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            // Update system stats
            updateSystemStats();
            showNotification('آمار بروزرسانی شد! 📊', 'success');
        }

        function updateSystemStats() {
            // Calculate total tests from all users
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            let totalTests = 0;
            let totalDNS = 0;
            
            users.forEach(user => {
                const userDataKey = `dnsManagerUserData_${user.id}`;
                const userData = JSON.parse(localStorage.getItem(userDataKey) || '{}');
                totalTests += userData.totalTests || 0;
                totalDNS += (userData.savedDNS || []).length;
            });
            
            systemData.totalTests = totalTests;
            systemData.totalDNSGenerated = totalDNS;
            
            document.getElementById('totalSystemTests').textContent = totalTests;
            document.getElementById('totalDNSGenerated').textContent = totalDNS;
            
            // Update recent activities
            const activitiesDiv = document.getElementById('recentActivities');
            if (systemData.activities.length === 0) {
                activitiesDiv.innerHTML = '<div class="opacity-75">فعالیتی ثبت نشده</div>';
            } else {
                activitiesDiv.innerHTML = systemData.activities.slice(-10).reverse().map(activity => `
                    <div class="opacity-75">${activity.date}: ${activity.action}</div>
                `).join('');
            }
        }

        function addSystemActivity(action) {
            systemData.activities.push({
                date: new Date().toLocaleDateString('fa-IR'),
                time: new Date().toLocaleTimeString('fa-IR'),
                action: action
            });
            
            // Keep only last 50 activities
            if (systemData.activities.length > 50) {
                systemData.activities = systemData.activities.slice(-50);
            }
            
            localStorage.setItem('systemData', JSON.stringify(systemData));
        }

        function deleteAllUsers() {
            if (!isAdmin()) {
                showNotification('دسترسی غیرمجاز!', 'error');
                return;
            }

            if (confirm('آیا مطمئن هستید که می‌خواهید تمام کاربران را حذف کنید؟ این عمل قابل بازگشت نیست!')) {
                localStorage.removeItem('registeredUsers');
                
                // Clear all user data
                const keys = Object.keys(localStorage);
                keys.forEach(key => {
                    if (key.startsWith('dnsManagerUserData_')) {
                        localStorage.removeItem(key);
                    }
                });
                
                refreshUserStats();
                showNotification('تمام کاربران حذف شدند! 🗑️', 'success');
                addSystemActivity('تمام کاربران توسط ادمین حذف شدند');
            }
        }

        function deleteSpecificUser(userId) {
            if (!isAdmin()) {
                showNotification('دسترسی غیرمجاز!', 'error');
                return;
            }

            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const userIndex = users.findIndex(u => u.id === userId);
            
            if (userIndex === -1) {
                showNotification('کاربر یافت نشد!', 'error');
                return;
            }

            const user = users[userIndex];
            
            if (confirm(`آیا مطمئن هستید که می‌خواهید کاربر "${user.name}" را حذف کنید؟`)) {
                // Remove user from list
                users.splice(userIndex, 1);
                localStorage.setItem('registeredUsers', JSON.stringify(users));
                
                // Remove user data
                localStorage.removeItem(`dnsManagerUserData_${userId}`);
                
                // If current user is being deleted, logout
                if (currentUser && currentUser.id === userId) {
                    logoutUser();
                }
                
                refreshUserStats();
                showNotification(`کاربر "${user.name}" حذف شد! 🗑️`, 'success');
                addSystemActivity(`کاربر "${user.name}" توسط ادمین حذف شد`);
            }
        }

        function clearAllUserData() {
            if (!isAdmin()) {
                showNotification('دسترسی غیرمجاز!', 'error');
                return;
            }

            if (confirm('آیا مطمئن هستید که می‌خواهید تمام داده‌های کاربران را پاک کنید؟ این عمل قابل بازگشت نیست!')) {
                localStorage.removeItem('registeredUsers');
                localStorage.removeItem('systemData');
                
                // Clear all user data
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('dnsManagerUserData_')) {
                        localStorage.removeItem(key);
                    }
                }
                
                systemData = { totalTests: 0, totalDNSGenerated: 0, activities: [] };
                refreshUserStats();
                showNotification('تمام داده‌های کاربران پاک شد! 🧹', 'success');
                addSystemActivity('تمام داده‌های کاربران پاک شد');
            }
        }

        function exportUserData() {
            if (!isAdmin()) {
                showNotification('دسترسی غیرمجاز!', 'error');
                return;
            }

            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const exportData = {
                exportDate: new Date().toISOString(),
                totalUsers: users.length,
                users: users.map(user => ({
                    name: user.name,
                    username: user.username,
                    joinDate: user.joinDate
                })),
                systemStats: systemData
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `dns_manager_export_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            showNotification('داده‌ها صادر شد! 📥', 'success');
            addSystemActivity('داده‌های سیستم صادر شد');
        }

        function systemMaintenance() {
            if (!isAdmin()) {
                showNotification('دسترسی غیرمجاز!', 'error');
                return;
            }

            showNotification('تعمیر و نگهداری سیستم شروع شد... ⚙️', 'info');
            
            setTimeout(() => {
                // Simulate maintenance tasks
                localStorage.setItem('lastMaintenance', new Date().toISOString());
                showNotification('تعمیر و نگهداری کامل شد! ✅', 'success');
                addSystemActivity('تعمیر و نگهداری سیستم انجام شد');
            }, 3000);
        }

        function generateSystemReport() {
            if (!isAdmin()) {
                showNotification('دسترسی غیرمجاز!', 'error');
                return;
            }

            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const report = `
📋 گزارش سیستم DNS Manager
تاریخ: ${new Date().toLocaleDateString('fa-IR')}

👥 آمار کاربران:
- کل کاربران: ${users.length}
- کاربران فعال: ${users.filter(u => u.joinDate).length}

📊 آمار عملکرد:
- کل تست‌ها: ${systemData.totalTests}
- DNS های تولید شده: ${systemData.totalDNSGenerated}
- آخرین فعالیت: ${systemData.activities.length > 0 ? systemData.activities[systemData.activities.length - 1].action : 'ندارد'}

🔧 وضعیت سیستم:
- آخرین تعمیر: ${localStorage.getItem('lastMaintenance') ? new Date(localStorage.getItem('lastMaintenance')).toLocaleDateString('fa-IR') : 'انجام نشده'}
- پیام همگانی: ${localStorage.getItem('globalMessage') ? 'فعال' : 'غیرفعال'}

✅ سیستم در وضعیت عادی قرار دارد.
            `.trim();

            const reportBlob = new Blob([report], { type: 'text/plain; charset=utf-8' });
            const url = URL.createObjectURL(reportBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `system_report_${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
            
            URL.revokeObjectURL(url);
            showNotification('گزارش سیستم تولید شد! 📋', 'success');
            addSystemActivity('گزارش سیستم تولید شد');
        }

        // Load system data on startup
        function loadSystemData() {
            const saved = localStorage.getItem('systemData');
            if (saved) {
                systemData = { ...systemData, ...JSON.parse(saved) };
            }
        }

        // Initialize admin panel when showing admin section
        function initializeAdminPanel() {
            if (!isAdmin()) {
                showNotification('دسترسی غیرمجاز!', 'error');
                showSection('home');
                return;
            }

            // Load current global message
            const globalMessage = localStorage.getItem('globalMessage');
            if (globalMessage) {
                const messageData = JSON.parse(globalMessage);
                const currentMessageDiv = document.getElementById('currentGlobalMessage');
                const currentContentDiv = document.getElementById('currentMessageContent');
                const currentDateDiv = document.getElementById('currentMessageDate');
                
                currentContentDiv.textContent = messageData.content;
                currentDateDiv.textContent = new Date(messageData.date).toLocaleDateString('fa-IR');
                currentMessageDiv.classList.remove('hidden');
            }

            // Refresh stats
            refreshUserStats();
        }


    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'989bbefa11bdf4e5',t:'MTc1OTY1NTAwOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
